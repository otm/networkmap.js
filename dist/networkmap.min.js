/*! networkmap 2016-05-19 */
!function(a,b){"function"==typeof define&&define.amd?define(function(){return b(a,a.document)}):"object"==typeof exports?module.exports=a.document?b(a,a.document):function(a){return b(a,a.document)}:a.SVG=b(a,a.document)}("undefined"!=typeof window?window:this,function(a,b){function c(a,b){return(a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector).call(a,b)}function d(a){return a.toLowerCase().replace(/-(.)/g,function(a,b){return b.toUpperCase()})}function e(a){return a.charAt(0).toUpperCase()+a.slice(1)}function f(a){return 4==a.length?["#",a.substring(1,2),a.substring(1,2),a.substring(2,3),a.substring(2,3),a.substring(3,4),a.substring(3,4)].join(""):a}function g(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function h(a,b,c){return null==c?c=a.height/a.width*b:null==b&&(b=a.width/a.height*c),{width:b,height:c}}function i(a,b,c){return{x:b*a.a+c*a.c+0,y:b*a.b+c*a.d+0}}function j(a){return{a:a[0],b:a[1],c:a[2],d:a[3],e:a[4],f:a[5]}}function k(a){return a instanceof s.Matrix||(a=new s.Matrix(a)),a}function l(a,b){a.cx=null==a.cx?b.bbox().cx:a.cx,a.cy=null==a.cy?b.bbox().cy:a.cy}function m(a){return a=a.replace(s.regex.whitespace,"").replace(s.regex.matrix,"").split(s.regex.matrixElements),j(s.utils.map(a,function(a){return parseFloat(a)}))}function n(a,b){return"number"==typeof a.from?a.from+(a.to-a.from)*b:a instanceof s.Color||a instanceof s.Number||a instanceof s.Matrix?a.at(b):1>b?a.from:a.to}function o(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b][0],null!=a[b][1]&&(d+=a[b][1],null!=a[b][2]&&(d+=" ",d+=a[b][2],null!=a[b][3]&&(d+=" ",d+=a[b][3],d+=" ",d+=a[b][4],null!=a[b][5]&&(d+=" ",d+=a[b][5],d+=" ",d+=a[b][6],null!=a[b][7]&&(d+=" ",d+=a[b][7])))));return d+" "}function p(a){for(var b=a.childNodes.length-1;b>=0;b--)a.childNodes[b]instanceof SVGElement&&p(a.childNodes[b]);return s.adopt(a).id(s.eid(a.nodeName))}function q(a){return null==a.x&&(a.x=0,a.y=0,a.width=0,a.height=0),a.w=a.width,a.h=a.height,a.x2=a.x+a.width,a.y2=a.y+a.height,a.cx=a.x+a.width/2,a.cy=a.y+a.height/2,a}function r(a){var b=a.toString().match(s.regex.reference);return b?b[1]:void 0}var s=this.SVG=function(a){return s.supported?(a=new s.Doc(a),s.parser||s.prepare(a),a):void 0};if(s.ns="http://www.w3.org/2000/svg",s.xmlns="http://www.w3.org/2000/xmlns/",s.xlink="http://www.w3.org/1999/xlink",s.svgjs="http://svgjs.com/svgjs",s.supported=function(){return!!b.createElementNS&&!!b.createElementNS(s.ns,"svg").createSVGRect}(),!s.supported)return!1;s.did=1e3,s.eid=function(a){return"Svgjs"+e(a)+s.did++},s.create=function(a){var c=b.createElementNS(this.ns,a);return c.setAttribute("id",this.eid(a)),c},s.extend=function(){var a,b,c,d;for(a=[].slice.call(arguments),b=a.pop(),d=a.length-1;d>=0;d--)if(a[d])for(c in b)a[d].prototype[c]=b[c];s.Set&&s.Set.inherit&&s.Set.inherit()},s.invent=function(a){var b="function"==typeof a.create?a.create:function(){this.constructor.call(this,s.create(a.create))};return a.inherit&&(b.prototype=new a.inherit),a.extend&&s.extend(b,a.extend),a.construct&&s.extend(a.parent||s.Container,a.construct),b},s.adopt=function(a){if(!a)return null;if(a.instance)return a.instance;var b;return b="svg"==a.nodeName?a.parentNode instanceof SVGElement?new s.Nested:new s.Doc:"linearGradient"==a.nodeName?new s.Gradient("linear"):"radialGradient"==a.nodeName?new s.Gradient("radial"):s[e(a.nodeName)]?new(s[e(a.nodeName)]):new s.Element(a),b.type=a.nodeName,b.node=a,a.instance=b,b instanceof s.Doc&&b.namespace().defs(),b.setData(JSON.parse(a.getAttribute("svgjs:data"))||{}),b},s.prepare=function(a){var c=b.getElementsByTagName("body")[0],d=(c?new s.Doc(c):a.nested()).size(2,0),e=s.create("path");d.node.appendChild(e),s.parser={body:c||a.parent(),draw:d.style("opacity:0;position:fixed;left:100%;top:100%;overflow:hidden"),poly:d.polyline().node,path:e}},s.regex={numberAndUnit:/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,hex:/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rgb:/rgb\((\d+),(\d+),(\d+)\)/,reference:/#([a-z0-9\-_]+)/i,matrix:/matrix\(|\)/g,matrixElements:/,*\s+|,/,whitespace:/\s/g,isHex:/^#[a-f0-9]{3,6}$/i,isRgb:/^rgb\(/,isCss:/[^:]+:[^;]+;?/,isBlank:/^(\s+)?$/,isNumber:/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,isPercent:/^-?[\d\.]+%$/,isImage:/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,negExp:/e\-/gi,comma:/,/g,hyphen:/\-/g,pathLetters:/[MLHVCSQTAZ]/gi,isPathLetter:/[MLHVCSQTAZ]/i,whitespaces:/\s+/,X:/X/g},s.utils={map:function(a,b){var c,d=a.length,e=[];for(c=0;d>c;c++)e.push(b(a[c]));return e},radians:function(a){return a%360*Math.PI/180},degrees:function(a){return 180*a/Math.PI%360},filterSVGElements:function(a){return[].filter.call(a,function(a){return a instanceof SVGElement})}},s.defaults={attrs:{"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","font-size":16,"font-family":"Helvetica, Arial, sans-serif","text-anchor":"start"}},s.Color=function(a){var b;this.r=0,this.g=0,this.b=0,"string"==typeof a?s.regex.isRgb.test(a)?(b=s.regex.rgb.exec(a.replace(/\s/g,"")),this.r=parseInt(b[1]),this.g=parseInt(b[2]),this.b=parseInt(b[3])):s.regex.isHex.test(a)&&(b=s.regex.hex.exec(f(a)),this.r=parseInt(b[1],16),this.g=parseInt(b[2],16),this.b=parseInt(b[3],16)):"object"==typeof a&&(this.r=a.r,this.g=a.g,this.b=a.b)},s.extend(s.Color,{toString:function(){return this.toHex()},toHex:function(){return"#"+g(this.r)+g(this.g)+g(this.b)},toRgb:function(){return"rgb("+[this.r,this.g,this.b].join()+")"},brightness:function(){return this.r/255*.3+this.g/255*.59+this.b/255*.11},morph:function(a){return this.destination=new s.Color(a),this},at:function(a){return this.destination?(a=0>a?0:a>1?1:a,new s.Color({r:~~(this.r+(this.destination.r-this.r)*a),g:~~(this.g+(this.destination.g-this.g)*a),b:~~(this.b+(this.destination.b-this.b)*a)})):this}}),s.Color.test=function(a){return a+="",s.regex.isHex.test(a)||s.regex.isRgb.test(a)},s.Color.isRgb=function(a){return a&&"number"==typeof a.r&&"number"==typeof a.g&&"number"==typeof a.b},s.Color.isColor=function(a){return s.Color.isRgb(a)||s.Color.test(a)},s.Array=function(a,b){a=(a||[]).valueOf(),0==a.length&&b&&(a=b.valueOf()),this.value=this.parse(a)},s.extend(s.Array,{morph:function(a){if(this.destination=this.parse(a),this.value.length!=this.destination.length){for(var b=this.value[this.value.length-1],c=this.destination[this.destination.length-1];this.value.length>this.destination.length;)this.destination.push(c);for(;this.value.length<this.destination.length;)this.value.push(b)}return this},settle:function(){for(var a=0,b=this.value.length,c=[];b>a;a++)-1==c.indexOf(this.value[a])&&c.push(this.value[a]);return this.value=c},at:function(a){if(!this.destination)return this;for(var b=0,c=this.value.length,d=[];c>b;b++)d.push(this.value[b]+(this.destination[b]-this.value[b])*a);return new s.Array(d)},toString:function(){return this.value.join(" ")},valueOf:function(){return this.value},parse:function(a){return a=a.valueOf(),Array.isArray(a)?a:this.split(a)},split:function(a){return a.trim().split(/\s+/)},reverse:function(){return this.value.reverse(),this}}),s.PointArray=function(a,b){this.constructor.call(this,a,b||[[0,0]])},s.PointArray.prototype=new s.Array,s.extend(s.PointArray,{toString:function(){for(var a=0,b=this.value.length,c=[];b>a;a++)c.push(this.value[a].join(","));return c.join(" ")},toLine:function(){return{x1:this.value[0][0],y1:this.value[0][1],x2:this.value[1][0],y2:this.value[1][1]}},at:function(a){if(!this.destination)return this;for(var b=0,c=this.value.length,d=[];c>b;b++)d.push([this.value[b][0]+(this.destination[b][0]-this.value[b][0])*a,this.value[b][1]+(this.destination[b][1]-this.value[b][1])*a]);return new s.PointArray(d)},parse:function(a){if(a=a.valueOf(),Array.isArray(a))return a;a=this.split(a);for(var b,c=0,d=a.length,e=[];d>c;c++)b=a[c].split(","),e.push([parseFloat(b[0]),parseFloat(b[1])]);return e},move:function(a,b){var c=this.bbox();if(a-=c.x,b-=c.y,!isNaN(a)&&!isNaN(b))for(var d=this.value.length-1;d>=0;d--)this.value[d]=[this.value[d][0]+a,this.value[d][1]+b];return this},size:function(a,b){var c,d=this.bbox();for(c=this.value.length-1;c>=0;c--)this.value[c][0]=(this.value[c][0]-d.x)*a/d.width+d.x,this.value[c][1]=(this.value[c][1]-d.y)*b/d.height+d.y;return this},bbox:function(){return s.parser.poly.setAttribute("points",this.toString()),s.parser.poly.getBBox()}}),s.PathArray=function(a,b){this.constructor.call(this,a,b||[["M",0,0]])},s.PathArray.prototype=new s.Array,s.extend(s.PathArray,{toString:function(){return o(this.value)},move:function(a,b){var c=this.bbox();if(a-=c.x,b-=c.y,!isNaN(a)&&!isNaN(b))for(var d,e=this.value.length-1;e>=0;e--)d=this.value[e][0],"M"==d||"L"==d||"T"==d?(this.value[e][1]+=a,this.value[e][2]+=b):"H"==d?this.value[e][1]+=a:"V"==d?this.value[e][1]+=b:"C"==d||"S"==d||"Q"==d?(this.value[e][1]+=a,this.value[e][2]+=b,this.value[e][3]+=a,this.value[e][4]+=b,"C"==d&&(this.value[e][5]+=a,this.value[e][6]+=b)):"A"==d&&(this.value[e][6]+=a,this.value[e][7]+=b);return this},size:function(a,b){var c,d,e=this.bbox();for(c=this.value.length-1;c>=0;c--)d=this.value[c][0],"M"==d||"L"==d||"T"==d?(this.value[c][1]=(this.value[c][1]-e.x)*a/e.width+e.x,this.value[c][2]=(this.value[c][2]-e.y)*b/e.height+e.y):"H"==d?this.value[c][1]=(this.value[c][1]-e.x)*a/e.width+e.x:"V"==d?this.value[c][1]=(this.value[c][1]-e.y)*b/e.height+e.y:"C"==d||"S"==d||"Q"==d?(this.value[c][1]=(this.value[c][1]-e.x)*a/e.width+e.x,this.value[c][2]=(this.value[c][2]-e.y)*b/e.height+e.y,this.value[c][3]=(this.value[c][3]-e.x)*a/e.width+e.x,this.value[c][4]=(this.value[c][4]-e.y)*b/e.height+e.y,"C"==d&&(this.value[c][5]=(this.value[c][5]-e.x)*a/e.width+e.x,this.value[c][6]=(this.value[c][6]-e.y)*b/e.height+e.y)):"A"==d&&(this.value[c][1]=this.value[c][1]*a/e.width,this.value[c][2]=this.value[c][2]*b/e.height,this.value[c][6]=(this.value[c][6]-e.x)*a/e.width+e.x,this.value[c][7]=(this.value[c][7]-e.y)*b/e.height+e.y);return this},parse:function(a){if(a instanceof s.PathArray)return a.valueOf();var b,c,d,e,f,g,h=0,i=0,j={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7};if("string"==typeof a){for(a=a.replace(s.regex.negExp,"X").replace(s.regex.pathLetters," $& ").replace(s.regex.hyphen," -").replace(s.regex.comma," ").replace(s.regex.X,"e-").trim().split(s.regex.whitespaces),b=a.length;--b;)if(a[b].indexOf(".")!=a[b].lastIndexOf(".")){var k=a[b].split("."),l=[k.shift(),k.shift()].join(".");a.splice.apply(a,[b,1].concat(l,k.map(function(a){return"."+a})))}}else a=a.reduce(function(a,b){return[].concat.apply(a,b)},[]);var g=[];do{for(s.regex.isPathLetter.test(a[0])?(e=a[0],a.shift()):"M"==e?e="L":"m"==e&&(e="l"),f=[e.toUpperCase()],b=0;b<j[f[0]];++b)f.push(parseFloat(a.shift()));e==f[0]?"M"==e||"L"==e||"C"==e||"Q"==e?(h=f[j[f[0]]-1],i=f[j[f[0]]]):"V"==e?i=f[1]:"H"==e?h=f[1]:"A"==e&&(h=f[6],i=f[7]):"m"==e||"l"==e||"c"==e||"s"==e||"q"==e||"t"==e?(f[1]+=h,f[2]+=i,null!=f[3]&&(f[3]+=h,f[4]+=i),null!=f[5]&&(f[5]+=h,f[6]+=i),h=f[j[f[0]]-1],i=f[j[f[0]]]):"v"==e?(f[1]+=i,i=f[1]):"h"==e?(f[1]+=h,h=f[1]):"a"==e&&(f[6]+=h,f[7]+=i,h=f[6],i=f[7]),"M"==f[0]&&(c=h,d=i),"Z"==f[0]&&(h=c,i=d),g.push(f)}while(a.length);return g},bbox:function(){return s.parser.path.setAttribute("d",this.toString()),s.parser.path.getBBox()}}),s.Number=s.invent({create:function(a,b){this.value=0,this.unit=b||"","number"==typeof a?this.value=isNaN(a)?0:isFinite(a)?a:0>a?-3.4e38:3.4e38:"string"==typeof a?(b=a.match(s.regex.numberAndUnit),b&&(this.value=parseFloat(b[1]),"%"==b[5]?this.value/=100:"s"==b[5]&&(this.value*=1e3),this.unit=b[5])):a instanceof s.Number&&(this.value=a.valueOf(),this.unit=a.unit)},extend:{toString:function(){return("%"==this.unit?~~(1e8*this.value)/1e6:"s"==this.unit?this.value/1e3:this.value)+this.unit},toJSON:function(){return this.toString()},valueOf:function(){return this.value},plus:function(a){return new s.Number(this+new s.Number(a),this.unit)},minus:function(a){return this.plus(-new s.Number(a))},times:function(a){return new s.Number(this*new s.Number(a),this.unit)},divide:function(a){return new s.Number(this/new s.Number(a),this.unit)},to:function(a){var b=new s.Number(this);return"string"==typeof a&&(b.unit=a),b},morph:function(a){return this.destination=new s.Number(a),this},at:function(a){return this.destination?new s.Number(this.destination).minus(this).times(a).plus(this):this}}}),s.ViewBox=function(a){var b,c,d,e,f=1,g=1,h=a.bbox(),i=(a.attr("viewBox")||"").match(/-?[\d\.]+/g),j=a,k=a;for(d=new s.Number(a.width()),e=new s.Number(a.height());"%"==d.unit;)f*=d.value,d=new s.Number(j instanceof s.Doc?j.parent().offsetWidth:j.parent().width()),j=j.parent();for(;"%"==e.unit;)g*=e.value,e=new s.Number(k instanceof s.Doc?k.parent().offsetHeight:k.parent().height()),k=k.parent();this.x=h.x,this.y=h.y,this.width=d*f,this.height=e*g,this.zoom=1,i&&(b=parseFloat(i[0]),c=parseFloat(i[1]),d=parseFloat(i[2]),e=parseFloat(i[3]),this.zoom=this.width/this.height>d/e?this.height/e:this.width/d,this.x=b,this.y=c,this.width=d,this.height=e)},s.extend(s.ViewBox,{toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height}}),s.Element=s.invent({create:function(a){this._stroke=s.defaults.attrs.stroke,this.dom={},(this.node=a)&&(this.type=a.nodeName,this.node.instance=this,this._stroke=a.getAttribute("stroke")||this._stroke)},extend:{x:function(a){return this.attr("x",a)},y:function(a){return this.attr("y",a)},cx:function(a){return null==a?this.x()+this.width()/2:this.x(a-this.width()/2)},cy:function(a){return null==a?this.y()+this.height()/2:this.y(a-this.height()/2)},move:function(a,b){return this.x(a).y(b)},center:function(a,b){return this.cx(a).cy(b)},width:function(a){return this.attr("width",a)},height:function(a){return this.attr("height",a)},size:function(a,b){var c=h(this.bbox(),a,b);return this.width(new s.Number(c.width)).height(new s.Number(c.height))},clone:function(){var a=p(this.node.cloneNode(!0));return this.after(a),a},remove:function(){return this.parent()&&this.parent().removeElement(this),this},replace:function(a){return this.after(a).remove(),a},addTo:function(a){return a.put(this)},putIn:function(a){return a.add(this)},id:function(a){return this.attr("id",a)},inside:function(a,b){var c=this.bbox();return a>c.x&&b>c.y&&a<c.x+c.width&&b<c.y+c.height},show:function(){return this.style("display","")},hide:function(){return this.style("display","none")},visible:function(){return"none"!=this.style("display")},toString:function(){return this.attr("id")},classes:function(){var a=this.attr("class");return null==a?[]:a.trim().split(/\s+/)},hasClass:function(a){return-1!=this.classes().indexOf(a)},addClass:function(a){if(!this.hasClass(a)){var b=this.classes();b.push(a),this.attr("class",b.join(" "))}return this},removeClass:function(a){return this.hasClass(a)&&this.attr("class",this.classes().filter(function(b){return b!=a}).join(" ")),this},toggleClass:function(a){return this.hasClass(a)?this.removeClass(a):this.addClass(a)},reference:function(a){return s.get(this.attr(a))},parent:function(a){var b=this;if(!b.node.parentNode)return null;if(b=s.adopt(b.node.parentNode),!a)return b;for(;b.node instanceof SVGElement;){if("string"==typeof a?b.matches(a):b instanceof a)return b;b=s.adopt(b.node.parentNode)}},doc:function(){return this instanceof s.Doc?this:this.parent(s.Doc)},parents:function(a){var b=[],c=this;do{if(c=c.parent(a),!c||!c.node)break;b.push(c)}while(c.parent);return b},matches:function(a){return c(this.node,a)},"native":function(){return this.node},svg:function(a){var c=b.createElement("svg");if(!(a&&this instanceof s.Parent))return c.appendChild(a=b.createElement("svg")),this.writeDataToDom(),a.appendChild(this.node.cloneNode(!0)),c.innerHTML.replace(/^<svg>/,"").replace(/<\/svg>$/,"");c.innerHTML="<svg>"+a.replace(/\n/,"").replace(/<(\w+)([^<]+?)\/>/g,"<$1$2></$1>")+"</svg>";for(var d=0,e=c.firstChild.childNodes.length;e>d;d++)this.node.appendChild(c.firstChild.firstChild);return this},writeDataToDom:function(){if(this.each||this.lines){var a=this.each?this:this.lines();a.each(function(){this.writeDataToDom()})}return this.node.removeAttribute("svgjs:data"),Object.keys(this.dom).length&&this.node.setAttribute("svgjs:data",JSON.stringify(this.dom)),this},setData:function(a){return this.dom=a,this}}}),s.FX=s.invent({create:function(a){this.target=a},extend:{animate:function(a,b,c){var d,e,f,g=this.target,h=this;return"object"==typeof a&&(c=a.delay,b=a.ease,a=a.duration),a="="==a?a:null==a?1e3:new s.Number(a).valueOf(),b=b||"<>",h.at=function(a){var c;if(a=0>a?0:a>1?1:a,null==d){d=[];for(f in h.attrs)d.push(f);if(g.morphArray&&(h.destination.plot||d.indexOf("points")>-1)){var i,j=new g.morphArray(h.destination.plot||h.attrs.points||g.array());h.destination.size&&j.size(h.destination.size.width.to,h.destination.size.height.to),i=j.bbox(),h.destination.x?j.move(h.destination.x.to,i.y):h.destination.cx&&j.move(h.destination.cx.to-i.width/2,i.y),i=j.bbox(),h.destination.y?j.move(i.x,h.destination.y.to):h.destination.cy&&j.move(i.x,h.destination.cy.to-i.height/2),h.destination={plot:g.array().morph(j)}}}if(null==e){e=[];for(f in h.styles)e.push(f)}for(a="<>"==b?-Math.cos(a*Math.PI)/2+.5:">"==b?Math.sin(a*Math.PI/2):"<"==b?-Math.cos(a*Math.PI/2)+1:"-"==b?a:"function"==typeof b?b(a):a,h.destination.plot?g.plot(h.destination.plot.at(a)):(h.destination.x?g.x(h.destination.x.at(a)):h.destination.cx&&g.cx(h.destination.cx.at(a)),h.destination.y?g.y(h.destination.y.at(a)):h.destination.cy&&g.cy(h.destination.cy.at(a)),h.destination.size&&g.size(h.destination.size.width.at(a),h.destination.size.height.at(a))),h.destination.viewbox&&g.viewbox(h.destination.viewbox.x.at(a),h.destination.viewbox.y.at(a),h.destination.viewbox.width.at(a),h.destination.viewbox.height.at(a)),h.destination.leading&&g.leading(h.destination.leading.at(a)),c=d.length-1;c>=0;c--)g.attr(d[c],n(h.attrs[d[c]],a));for(c=e.length-1;c>=0;c--)g.style(e[c],n(h.styles[e[c]],a));h.situation.during&&h.situation.during.call(g,a,function(b,c){return n({from:b,to:c},a)})},"number"==typeof a&&(this.timeout=setTimeout(function(){var d=(new Date).getTime();h.situation.start=d,h.situation.play=!0,h.situation.finish=d+a,h.situation.duration=a,h.situation.ease=b,h.render=function(){if(h.situation.play===!0){var d=(new Date).getTime(),e=d>h.situation.finish?1:(d-h.situation.start)/a;h.situation.reversing&&(e=-e+1),h.at(e),d>h.situation.finish?(h.destination.plot&&g.plot(new s.PointArray(h.destination.plot.destination).settle()),h.situation.loop===!0||"number"==typeof h.situation.loop&&h.situation.loop>0?(h.situation.reverse&&(h.situation.reversing=!h.situation.reversing),"number"==typeof h.situation.loop&&((!h.situation.reverse||h.situation.reversing)&&--h.situation.loop,h.situation.reverse||1!=h.situation.loop||--h.situation.loop),h.animate(a,b,c)):h.situation.after?h.situation.after.apply(g,[h]):h.stop()):h.animationFrame=requestAnimationFrame(h.render)}else h.animationFrame=requestAnimationFrame(h.render)},h.render()},new s.Number(c).valueOf())),this},bbox:function(){return this.target.bbox()},attr:function(a,b){if("object"==typeof a)for(var c in a)this.attr(c,a[c]);else{var d=this.target.attr(a);"transform"==a?(this.attrs[a]&&(b=this.attrs[a].destination.multiply(b)),this.attrs[a]=new s.Matrix(this.target).morph(b),this.param&&(b=this.target.transform("rotation"),this.attrs[a].param={from:this.target.param||{rotation:b,cx:this.param.cx,cy:this.param.cy},to:this.param})):this.attrs[a]=s.Color.isColor(b)?new s.Color(d).morph(b):s.regex.numberAndUnit.test(b)?new s.Number(d).morph(b):{from:d,to:b}}return this},style:function(a,b){if("object"==typeof a)for(var c in a)this.style(c,a[c]);else this.styles[a]={from:this.target.style(a),to:b};return this},x:function(a){return this.destination.x=new s.Number(this.target.x()).morph(a),this},y:function(a){return this.destination.y=new s.Number(this.target.y()).morph(a),this},cx:function(a){return this.destination.cx=new s.Number(this.target.cx()).morph(a),this},cy:function(a){return this.destination.cy=new s.Number(this.target.cy()).morph(a),this},move:function(a,b){return this.x(a).y(b)},center:function(a,b){return this.cx(a).cy(b)},size:function(a,b){if(this.target instanceof s.Text)this.attr("font-size",a);else{var c=this.target.bbox();this.destination.size={width:new s.Number(c.width).morph(a),height:new s.Number(c.height).morph(b)}}return this},plot:function(a){return this.destination.plot=a,this},leading:function(a){return this.target.destination.leading&&(this.destination.leading=new s.Number(this.target.destination.leading).morph(a)),this},viewbox:function(a,b,c,d){if(this.target instanceof s.Container){var e=this.target.viewbox();this.destination.viewbox={x:new s.Number(e.x).morph(a),y:new s.Number(e.y).morph(b),width:new s.Number(e.width).morph(c),height:new s.Number(e.height).morph(d)}}return this},update:function(a){return this.target instanceof s.Stop&&(null!=a.opacity&&this.attr("stop-opacity",a.opacity),null!=a.color&&this.attr("stop-color",a.color),null!=a.offset&&this.attr("offset",new s.Number(a.offset))),this},during:function(a){return this.situation.during=a,this},after:function(a){return this.situation.after=a,this},loop:function(a,b){return this.situation.loop=this.situation.loops=a||!0,this.situation.reverse=!!b,this},stop:function(a){return a===!0?(this.animate(0),this.situation.after&&this.situation.after.apply(this.target,[this])):(clearTimeout(this.timeout),cancelAnimationFrame(this.animationFrame),this.attrs={},this.styles={},this.situation={},this.destination={}),this},pause:function(){return this.situation.play===!0&&(this.situation.play=!1,this.situation.pause=(new Date).getTime()),this},play:function(){if(this.situation.play===!1){var a=(new Date).getTime()-this.situation.pause;this.situation.finish+=a,this.situation.start+=a,this.situation.play=!0}return this}},parent:s.Element,construct:{animate:function(a,b,c){return(this.fx||(this.fx=new s.FX(this))).stop().animate(a,b,c)},stop:function(a){return this.fx&&this.fx.stop(a),this},pause:function(){return this.fx&&this.fx.pause(),this},play:function(){return this.fx&&this.fx.play(),this}}}),s.BBox=s.invent({create:function(a){if(a){var b;try{b=a.node.getBBox()}catch(c){if(a instanceof s.Shape){var d=a.clone().addTo(s.parser.draw);b=d.bbox(),d.remove()}else b={x:a.node.clientLeft,y:a.node.clientTop,width:a.node.clientWidth,height:a.node.clientHeight}}this.x=b.x,this.y=b.y,this.width=b.width,this.height=b.height}q(this)},parent:s.Element,construct:{bbox:function(){return new s.BBox(this)}}}),s.TBox=s.invent({create:function(a){if(a){var b=a.ctm().extract(),c=a.bbox();this.width=c.width*b.scaleX,this.height=c.height*b.scaleY,this.x=c.x+b.x,this.y=c.y+b.y}q(this)},parent:s.Element,construct:{tbox:function(){return new s.TBox(this)}}}),s.RBox=s.invent({create:function(b){if(b){var c=b.doc().parent(),d=b.node.getBoundingClientRect(),e=1;for(this.x=d.left,this.y=d.top,this.x-=c.offsetLeft,this.y-=c.offsetTop;c=c.offsetParent;)this.x-=c.offsetLeft,this.y-=c.offsetTop;for(c=b;c.parent&&(c=c.parent());)c.viewbox&&(e*=c.viewbox().zoom,this.x-=c.x()||0,this.y-=c.y()||0);this.width=d.width/=e,this.height=d.height/=e}q(this),this.x+=a.pageXOffset,this.y+=a.pageYOffset},parent:s.Element,construct:{rbox:function(){return new s.RBox(this)}}}),[s.BBox,s.TBox,s.RBox].forEach(function(a){s.extend(a,{merge:function(b){var c=new a;return c.x=Math.min(this.x,b.x),c.y=Math.min(this.y,b.y),c.width=Math.max(this.x+this.width,b.x+b.width)-c.x,c.height=Math.max(this.y+this.height,b.y+b.height)-c.y,q(c)}})}),s.Matrix=s.invent({create:function(a){var b,c=j([1,0,0,1,0,0]);for(a=a instanceof s.Element?a.matrixify():"string"==typeof a?m(a):6==arguments.length?j([].slice.call(arguments)):"object"==typeof a?a:c,b=u.length-1;b>=0;b--)this[u[b]]=a&&"number"==typeof a[u[b]]?a[u[b]]:c[u[b]]},extend:{extract:function(){var a=i(this,0,1),b=i(this,1,0),c=180/Math.PI*Math.atan2(a.y,a.x)-90;return{x:this.e,y:this.f,skewX:-c,skewY:180/Math.PI*Math.atan2(b.y,b.x),scaleX:Math.sqrt(this.a*this.a+this.b*this.b),scaleY:Math.sqrt(this.c*this.c+this.d*this.d),rotation:c,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}},clone:function(){return new s.Matrix(this)},morph:function(a){return this.destination=new s.Matrix(a),this},at:function(a){if(!this.destination)return this;var b=new s.Matrix({a:this.a+(this.destination.a-this.a)*a,b:this.b+(this.destination.b-this.b)*a,c:this.c+(this.destination.c-this.c)*a,d:this.d+(this.destination.d-this.d)*a,e:this.e+(this.destination.e-this.e)*a,f:this.f+(this.destination.f-this.f)*a});if(this.param&&this.param.to){var c={rotation:this.param.from.rotation+(this.param.to.rotation-this.param.from.rotation)*a,cx:this.param.from.cx,cy:this.param.from.cy};b=b.rotate((this.param.to.rotation-2*this.param.from.rotation)*a,c.cx,c.cy),b.param=c}return b},multiply:function(a){return new s.Matrix(this["native"]().multiply(k(a)["native"]()))},inverse:function(){return new s.Matrix(this["native"]().inverse())},translate:function(a,b){return new s.Matrix(this["native"]().translate(a||0,b||0))},scale:function(a,b,c,d){return(1==arguments.length||3==arguments.length)&&(b=a),3==arguments.length&&(d=c,c=b),this.around(c,d,new s.Matrix(a,0,0,b,0,0))},rotate:function(a,b,c){return a=s.utils.radians(a),this.around(b,c,new s.Matrix(Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0))},flip:function(a,b){return"x"==a?this.scale(-1,1,b,0):this.scale(1,-1,0,b)},skew:function(a,b,c,d){return this.around(c,d,this["native"]().skewX(a||0).skewY(b||0))},skewX:function(a,b,c){return this.around(b,c,this["native"]().skewX(a||0))},skewY:function(a,b,c){return this.around(b,c,this["native"]().skewY(a||0))},around:function(a,b,c){return this.multiply(new s.Matrix(1,0,0,1,a||0,b||0)).multiply(c).multiply(new s.Matrix(1,0,0,1,-a||0,-b||0))},"native":function(){for(var a=s.parser.draw.node.createSVGMatrix(),b=u.length-1;b>=0;b--)a[u[b]]=this[u[b]];return a},toString:function(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}},parent:s.Element,construct:{ctm:function(){return new s.Matrix(this.node.getCTM())},screenCTM:function(){return new s.Matrix(this.node.getScreenCTM())}}}),s.Point=s.invent({create:function(a,b){var c,d={x:0,y:0};c=Array.isArray(a)?{x:a[0],y:a[1]}:"object"==typeof a?{x:a.x,y:a.y}:null!=b?{x:a,y:b}:d,this.x=c.x,this.y=c.y},extend:{clone:function(){return new s.Point(this)},morph:function(a){return this.destination=new s.Point(a),this},at:function(a){if(!this.destination)return this;var b=new s.Point({x:this.x+(this.destination.x-this.x)*a,y:this.y+(this.destination.y-this.y)*a});return b},"native":function(){var a=s.parser.draw.node.createSVGPoint();return a.x=this.x,a.y=this.y,a},transform:function(a){return new s.Point(this["native"]().matrixTransform(a["native"]()))}}}),s.extend(s.Element,{point:function(a,b){return new s.Point(a,b).transform(this.screenCTM().inverse())}}),s.extend(s.Element,{attr:function(a,b,c){if(null==a){for(a={},b=this.node.attributes,c=b.length-1;c>=0;c--)a[b[c].nodeName]=s.regex.isNumber.test(b[c].nodeValue)?parseFloat(b[c].nodeValue):b[c].nodeValue;return a}if("object"==typeof a)for(b in a)this.attr(b,a[b]);else if(null===b)this.node.removeAttribute(a);else{if(null==b)return b=this.node.getAttribute(a),null==b?s.defaults.attrs[a]:s.regex.isNumber.test(b)?parseFloat(b):b;"stroke-width"==a?this.attr("stroke",parseFloat(b)>0?this._stroke:null):"stroke"==a&&(this._stroke=b),("fill"==a||"stroke"==a)&&(s.regex.isImage.test(b)&&(b=this.doc().defs().image(b,0,0)),b instanceof s.Image&&(b=this.doc().defs().pattern(0,0,function(){this.add(b)}))),"number"==typeof b?b=new s.Number(b):s.Color.isColor(b)?b=new s.Color(b):Array.isArray(b)?b=new s.Array(b):b instanceof s.Matrix&&b.param&&(this.param=b.param),"leading"==a?this.leading&&this.leading(b):"string"==typeof c?this.node.setAttributeNS(c,a,b.toString()):this.node.setAttribute(a,b.toString()),!this.rebuild||"font-size"!=a&&"x"!=a||this.rebuild(a,b)}return this}}),s.extend(s.Element,s.FX,{transform:function(a,b){var c,d=this.target||this;if("object"!=typeof a)return c=new s.Matrix(d).extract(),"object"==typeof this.param&&(c.rotation=this.param.rotation,c.cx=this.param.cx,c.cy=this.param.cy),"string"==typeof a?c[a]:c;if(c=this instanceof s.FX&&this.attrs.transform?this.attrs.transform:new s.Matrix(d),b=!!b||!!a.relative,null!=a.a)c=b?c.multiply(new s.Matrix(a)):new s.Matrix(a);else if(null!=a.rotation)l(a,d),b&&(a.rotation+=this.param&&null!=this.param.rotation?this.param.rotation:c.extract().rotation),this.param=a,this instanceof s.Element&&(c=b?c.rotate(a.rotation,a.cx,a.cy):c.rotate(a.rotation-c.extract().rotation,a.cx,a.cy));else if(null!=a.scale||null!=a.scaleX||null!=a.scaleY){if(l(a,d),a.scaleX=null!=a.scale?a.scale:null!=a.scaleX?a.scaleX:1,a.scaleY=null!=a.scale?a.scale:null!=a.scaleY?a.scaleY:1,!b){var e=c.extract();a.scaleX=1*a.scaleX/e.scaleX,a.scaleY=1*a.scaleY/e.scaleY}c=c.scale(a.scaleX,a.scaleY,a.cx,a.cy)}else if(null!=a.skewX||null!=a.skewY){if(l(a,d),a.skewX=null!=a.skewX?a.skewX:0,a.skewY=null!=a.skewY?a.skewY:0,!b){var e=c.extract();c=c.multiply((new s.Matrix).skew(e.skewX,e.skewY,a.cx,a.cy).inverse())}c=c.skew(a.skewX,a.skewY,a.cx,a.cy)}else a.flip?c=c.flip(a.flip,null==a.offset?d.bbox()["c"+a.flip]:a.offset):(null!=a.x||null!=a.y)&&(b?c=c.translate(a.x,a.y):(null!=a.x&&(c.e=a.x),null!=a.y&&(c.f=a.y)));return this.attr(this instanceof s.Pattern?"patternTransform":this instanceof s.Gradient?"gradientTransform":"transform",c)}}),s.extend(s.Element,{untransform:function(){return this.attr("transform",null)},matrixify:function(){var a=(this.attr("transform")||"").split(/\)\s*/).slice(0,-1).map(function(a){var b=a.trim().split("(");return[b[0],b[1].split(s.regex.matrixElements).map(function(a){return parseFloat(a)})]}).reduce(function(a,b){return"matrix"==b[0]?a.multiply(j(b[1])):a[b[0]].apply(a,b[1])},new s.Matrix);return a},toParent:function(a){if(this==a)return this;var b=this.screenCTM(),c=a.rect(1,1),d=c.screenCTM().inverse();return c.remove(),this.addTo(a).untransform().transform(d.multiply(b)),this},toDoc:function(){return this.toParent(this.doc())}}),s.extend(s.Element,{style:function(a,b){if(0==arguments.length)return this.node.style.cssText||"";if(arguments.length<2)if("object"==typeof a)for(b in a)this.style(b,a[b]);else{if(!s.regex.isCss.test(a))return this.node.style[d(a)];a=a.split(";");for(var c=0;c<a.length;c++)b=a[c].split(":"),this.style(b[0].replace(/\s+/g,""),b[1])}else this.node.style[d(a)]=null===b||s.regex.isBlank.test(b)?"":b;return this}}),s.Parent=s.invent({create:function(a){this.constructor.call(this,a)},inherit:s.Element,extend:{children:function(){return s.utils.map(s.utils.filterSVGElements(this.node.childNodes),function(a){return s.adopt(a)})},add:function(a,b){return this.has(a)||(b=null==b?this.children().length:b,this.node.insertBefore(a.node,this.node.childNodes[b]||null)),this},put:function(a,b){return this.add(a,b),a},has:function(a){return this.index(a)>=0},index:function(a){return this.children().indexOf(a)},get:function(a){return this.children()[a]},first:function(){return this.children()[0]},last:function(){return this.children()[this.children().length-1]},each:function(a,b){var c,d,e=this.children();for(c=0,d=e.length;d>c;c++)e[c]instanceof s.Element&&a.apply(e[c],[c,e]),b&&e[c]instanceof s.Container&&e[c].each(a,b);return this},removeElement:function(a){return this.node.removeChild(a.node),this},clear:function(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return delete this._defs,this},defs:function(){return this.doc().defs()}}}),s.extend(s.Parent,{ungroup:function(a,b){return 0===b||this instanceof s.Defs?this:(a=a||(this instanceof s.Doc?this:this.parent(s.Parent)),b=b||1/0,this.each(function(){return this instanceof s.Defs?this:this instanceof s.Parent?this.ungroup(a,b-1):this.toParent(a);
}),this.node.firstChild||this.remove(),this)},flatten:function(a,b){return this.ungroup(a,b)}}),s.Container=s.invent({create:function(a){this.constructor.call(this,a)},inherit:s.Parent,extend:{viewbox:function(a){return 0==arguments.length?new s.ViewBox(this):(a=1==arguments.length?[a.x,a.y,a.width,a.height]:[].slice.call(arguments),this.attr("viewBox",a))}}}),["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","touchstart","touchmove","touchleave","touchend","touchcancel"].forEach(function(a){s.Element.prototype[a]=function(b){var c=this;return this.node["on"+a]="function"==typeof b?function(){return b.apply(c,arguments)}:null,this}}),s.listeners=[],s.handlerMap=[],s.on=function(a,b,c,d){var e=c.bind(d||a.instance||a),f=(s.handlerMap.indexOf(a)+1||s.handlerMap.push(a))-1,g=b.split(".")[0],h=b.split(".")[1]||"*";s.listeners[f]=s.listeners[f]||{},s.listeners[f][g]=s.listeners[f][g]||{},s.listeners[f][g][h]=s.listeners[f][g][h]||{},s.listeners[f][g][h][c]=e,a.addEventListener(g,e,!1)},s.off=function(a,b,c){var d=s.handlerMap.indexOf(a),e=b&&b.split(".")[0],f=b&&b.split(".")[1];if(-1!=d)if(c)s.listeners[d][e]&&s.listeners[d][e][f||"*"]&&(a.removeEventListener(e,s.listeners[d][e][f||"*"][c],!1),delete s.listeners[d][e][f||"*"][c]);else if(f&&e){if(s.listeners[d][e]&&s.listeners[d][e][f]){for(c in s.listeners[d][e][f])s.off(a,[e,f].join("."),c);delete s.listeners[d][e][f]}}else if(f)for(b in s.listeners[d])for(namespace in s.listeners[d][b])f===namespace&&s.off(a,[b,f].join("."));else if(e){if(s.listeners[d][e]){for(namespace in s.listeners[d][e])s.off(a,[e,namespace].join("."));delete s.listeners[d][e]}}else{for(b in s.listeners[d])s.off(a,b);delete s.listeners[d]}},s.extend(s.Element,{on:function(a,b,c){return s.on(this.node,a,b,c),this},off:function(a,b){return s.off(this.node,a,b),this},fire:function(a,b){return a instanceof Event?this.node.dispatchEvent(a):this.node.dispatchEvent(new v(a,{detail:b})),this}}),s.Defs=s.invent({create:"defs",inherit:s.Container}),s.G=s.invent({create:"g",inherit:s.Container,extend:{x:function(a){return null==a?this.transform("x"):this.transform({x:a-this.x()},!0)},y:function(a){return null==a?this.transform("y"):this.transform({y:a-this.y()},!0)},cx:function(a){return null==a?this.tbox().cx:this.x(a-this.tbox().width/2)},cy:function(a){return null==a?this.tbox().cy:this.y(a-this.tbox().height/2)},gbox:function(){var a=this.bbox(),b=this.transform();return a.x+=b.x,a.x2+=b.x,a.cx+=b.x,a.y+=b.y,a.y2+=b.y,a.cy+=b.y,a}},construct:{group:function(){return this.put(new s.G)}}}),s.extend(s.Element,{siblings:function(){return this.parent().children()},position:function(){return this.parent().index(this)},next:function(){return this.siblings()[this.position()+1]},previous:function(){return this.siblings()[this.position()-1]},forward:function(){var a=this.position()+1,b=this.parent();return b.removeElement(this).add(this,a),b instanceof s.Doc&&b.node.appendChild(b.defs().node),this},backward:function(){var a=this.position();return a>0&&this.parent().removeElement(this).add(this,a-1),this},front:function(){var a=this.parent();return a.node.appendChild(this.node),a instanceof s.Doc&&a.node.appendChild(a.defs().node),this},back:function(){return this.position()>0&&this.parent().removeElement(this).add(this,0),this},before:function(a){a.remove();var b=this.position();return this.parent().add(a,b),this},after:function(a){a.remove();var b=this.position();return this.parent().add(a,b+1),this}}),s.Mask=s.invent({create:function(){this.constructor.call(this,s.create("mask")),this.targets=[]},inherit:s.Container,extend:{remove:function(){for(var a=this.targets.length-1;a>=0;a--)this.targets[a]&&this.targets[a].unmask();return this.targets=[],this.parent().removeElement(this),this}},construct:{mask:function(){return this.defs().put(new s.Mask)}}}),s.extend(s.Element,{maskWith:function(a){return this.masker=a instanceof s.Mask?a:this.parent().mask().add(a),this.masker.targets.push(this),this.attr("mask",'url("#'+this.masker.attr("id")+'")')},unmask:function(){return delete this.masker,this.attr("mask",null)}}),s.ClipPath=s.invent({create:function(){this.constructor.call(this,s.create("clipPath")),this.targets=[]},inherit:s.Container,extend:{remove:function(){for(var a=this.targets.length-1;a>=0;a--)this.targets[a]&&this.targets[a].unclip();return this.targets=[],this.parent().removeElement(this),this}},construct:{clip:function(){return this.defs().put(new s.ClipPath)}}}),s.extend(s.Element,{clipWith:function(a){return this.clipper=a instanceof s.ClipPath?a:this.parent().clip().add(a),this.clipper.targets.push(this),this.attr("clip-path",'url("#'+this.clipper.attr("id")+'")')},unclip:function(){return delete this.clipper,this.attr("clip-path",null)}}),s.Gradient=s.invent({create:function(a){this.constructor.call(this,s.create(a+"Gradient")),this.type=a},inherit:s.Container,extend:{at:function(a,b,c){return this.put(new s.Stop).update(a,b,c)},update:function(a){return this.clear(),"function"==typeof a&&a.call(this,this),this},fill:function(){return"url(#"+this.id()+")"},toString:function(){return this.fill()},attr:function(a,b,c){return"transform"==a&&(a="gradientTransform"),s.Container.prototype.attr.call(this,a,b,c)}},construct:{gradient:function(a,b){return this.defs().gradient(a,b)}}}),s.extend(s.Gradient,s.FX,{from:function(a,b){return"radial"==(this.target||this).type?this.attr({fx:new s.Number(a),fy:new s.Number(b)}):this.attr({x1:new s.Number(a),y1:new s.Number(b)})},to:function(a,b){return"radial"==(this.target||this).type?this.attr({cx:new s.Number(a),cy:new s.Number(b)}):this.attr({x2:new s.Number(a),y2:new s.Number(b)})}}),s.extend(s.Defs,{gradient:function(a,b){return this.put(new s.Gradient(a)).update(b)}}),s.Stop=s.invent({create:"stop",inherit:s.Element,extend:{update:function(a){return("number"==typeof a||a instanceof s.Number)&&(a={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),null!=a.opacity&&this.attr("stop-opacity",a.opacity),null!=a.color&&this.attr("stop-color",a.color),null!=a.offset&&this.attr("offset",new s.Number(a.offset)),this}}}),s.Pattern=s.invent({create:"pattern",inherit:s.Container,extend:{fill:function(){return"url(#"+this.id()+")"},update:function(a){return this.clear(),"function"==typeof a&&a.call(this,this),this},toString:function(){return this.fill()},attr:function(a,b,c){return"transform"==a&&(a="patternTransform"),s.Container.prototype.attr.call(this,a,b,c)}},construct:{pattern:function(a,b,c){return this.defs().pattern(a,b,c)}}}),s.extend(s.Defs,{pattern:function(a,b,c){return this.put(new s.Pattern).update(c).attr({x:0,y:0,width:a,height:b,patternUnits:"userSpaceOnUse"})}}),s.Doc=s.invent({create:function(a){a&&(a="string"==typeof a?b.getElementById(a):a,"svg"==a.nodeName?this.constructor.call(this,a):(this.constructor.call(this,s.create("svg")),a.appendChild(this.node)),this.namespace().size("100%","100%").defs())},inherit:s.Container,extend:{namespace:function(){return this.attr({xmlns:s.ns,version:"1.1"}).attr("xmlns:xlink",s.xlink,s.xmlns).attr("xmlns:svgjs",s.svgjs,s.xmlns)},defs:function(){if(!this._defs){var a;(a=this.node.getElementsByTagName("defs")[0])?this._defs=s.adopt(a):this._defs=new s.Defs,this.node.appendChild(this._defs.node)}return this._defs},parent:function(){return"#document"==this.node.parentNode.nodeName?null:this.node.parentNode},spof:function(a){var b=this.node.getScreenCTM();return b&&this.style("left",-b.e%1+"px").style("top",-b.f%1+"px"),this},remove:function(){return this.parent()&&this.parent().removeChild(this.node),this}}}),s.Shape=s.invent({create:function(a){this.constructor.call(this,a)},inherit:s.Element}),s.Bare=s.invent({create:function(a,b){if(this.constructor.call(this,s.create(a)),b)for(var c in b.prototype)"function"==typeof b.prototype[c]&&(this[c]=b.prototype[c])},inherit:s.Element,extend:{words:function(a){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return this.node.appendChild(b.createTextNode(a)),this}}}),s.extend(s.Parent,{element:function(a,b){return this.put(new s.Bare(a,b))},symbol:function(){return this.defs().element("symbol",s.Container)}}),s.Use=s.invent({create:"use",inherit:s.Shape,extend:{element:function(a,b){return this.attr("href",(b||"")+"#"+a,s.xlink)}},construct:{use:function(a,b){return this.put(new s.Use).element(a,b)}}}),s.Rect=s.invent({create:"rect",inherit:s.Shape,construct:{rect:function(a,b){return this.put(new s.Rect).size(a,b)}}}),s.Circle=s.invent({create:"circle",inherit:s.Shape,construct:{circle:function(a){return this.put(new s.Circle).rx(new s.Number(a).divide(2)).move(0,0)}}}),s.extend(s.Circle,s.FX,{rx:function(a){return this.attr("r",a)},ry:function(a){return this.rx(a)}}),s.Ellipse=s.invent({create:"ellipse",inherit:s.Shape,construct:{ellipse:function(a,b){return this.put(new s.Ellipse).size(a,b).move(0,0)}}}),s.extend(s.Ellipse,s.Rect,s.FX,{rx:function(a){return this.attr("rx",a)},ry:function(a){return this.attr("ry",a)}}),s.extend(s.Circle,s.Ellipse,{x:function(a){return null==a?this.cx()-this.rx():this.cx(a+this.rx())},y:function(a){return null==a?this.cy()-this.ry():this.cy(a+this.ry())},cx:function(a){return null==a?this.attr("cx"):this.attr("cx",a)},cy:function(a){return null==a?this.attr("cy"):this.attr("cy",a)},width:function(a){return null==a?2*this.rx():this.rx(new s.Number(a).divide(2))},height:function(a){return null==a?2*this.ry():this.ry(new s.Number(a).divide(2))},size:function(a,b){var c=h(this.bbox(),a,b);return this.rx(new s.Number(c.width).divide(2)).ry(new s.Number(c.height).divide(2))}}),s.Line=s.invent({create:"line",inherit:s.Shape,extend:{array:function(){return new s.PointArray([[this.attr("x1"),this.attr("y1")],[this.attr("x2"),this.attr("y2")]])},plot:function(a,b,c,d){return a=4==arguments.length?{x1:a,y1:b,x2:c,y2:d}:new s.PointArray(a).toLine(),this.attr(a)},move:function(a,b){return this.attr(this.array().move(a,b).toLine())},size:function(a,b){var c=h(this.bbox(),a,b);return this.attr(this.array().size(c.width,c.height).toLine())}},construct:{line:function(a,b,c,d){return this.put(new s.Line).plot(a,b,c,d)}}}),s.Polyline=s.invent({create:"polyline",inherit:s.Shape,construct:{polyline:function(a){return this.put(new s.Polyline).plot(a)}}}),s.Polygon=s.invent({create:"polygon",inherit:s.Shape,construct:{polygon:function(a){return this.put(new s.Polygon).plot(a)}}}),s.extend(s.Polyline,s.Polygon,{array:function(){return this._array||(this._array=new s.PointArray(this.attr("points")))},plot:function(a){return this.attr("points",this._array=new s.PointArray(a))},move:function(a,b){return this.attr("points",this.array().move(a,b))},size:function(a,b){var c=h(this.bbox(),a,b);return this.attr("points",this.array().size(c.width,c.height))}}),s.extend(s.Line,s.Polyline,s.Polygon,{morphArray:s.PointArray,x:function(a){return null==a?this.bbox().x:this.move(a,this.bbox().y)},y:function(a){return null==a?this.bbox().y:this.move(this.bbox().x,a)},width:function(a){var b=this.bbox();return null==a?b.width:this.size(a,b.height)},height:function(a){var b=this.bbox();return null==a?b.height:this.size(b.width,a)}}),s.Path=s.invent({create:"path",inherit:s.Shape,extend:{morphArray:s.PathArray,array:function(){return this._array||(this._array=new s.PathArray(this.attr("d")))},plot:function(a){return this.attr("d",this._array=new s.PathArray(a))},move:function(a,b){return this.attr("d",this.array().move(a,b))},x:function(a){return null==a?this.bbox().x:this.move(a,this.bbox().y)},y:function(a){return null==a?this.bbox().y:this.move(this.bbox().x,a)},size:function(a,b){var c=h(this.bbox(),a,b);return this.attr("d",this.array().size(c.width,c.height))},width:function(a){return null==a?this.bbox().width:this.size(a,this.bbox().height)},height:function(a){return null==a?this.bbox().height:this.size(this.bbox().width,a)}},construct:{path:function(a){return this.put(new s.Path).plot(a)}}}),s.Image=s.invent({create:"image",inherit:s.Shape,extend:{load:function(a){if(!a)return this;var c=this,d=b.createElement("img");return d.onload=function(){var b=c.parent(s.Pattern);null!==b&&(0==c.width()&&0==c.height()&&c.size(d.width,d.height),b&&0==b.width()&&0==b.height()&&b.size(c.width(),c.height()),"function"==typeof c._loaded&&c._loaded.call(c,{width:d.width,height:d.height,ratio:d.width/d.height,url:a}))},this.attr("href",d.src=this.src=a,s.xlink)},loaded:function(a){return this._loaded=a,this}},construct:{image:function(a,b,c){return this.put(new s.Image).load(a).size(b||0,c||b||0)}}}),s.Text=s.invent({create:function(){this.constructor.call(this,s.create("text")),this.dom.leading=new s.Number(1.3),this._rebuild=!0,this._build=!1,this.attr("font-family",s.defaults.attrs["font-family"])},inherit:s.Shape,extend:{clone:function(){var a=p(this.node.cloneNode(!0));return this.after(a),a},x:function(a){return null==a?this.attr("x"):(this.textPath||this.lines().each(function(){this.dom.newLined&&this.x(a)}),this.attr("x",a))},y:function(a){var b=this.attr("y"),c="number"==typeof b?b-this.bbox().y:0;return null==a?"number"==typeof b?b-c:b:this.attr("y","number"==typeof a?a+c:a)},cx:function(a){return null==a?this.bbox().cx:this.x(a-this.bbox().width/2)},cy:function(a){return null==a?this.bbox().cy:this.y(a-this.bbox().height/2)},text:function(a){if("undefined"==typeof a){for(var a="",b=this.node.childNodes,c=0,d=b.length;d>c;++c)0!=c&&3!=b[c].nodeType&&1==s.adopt(b[c]).dom.newLined&&(a+="\n"),a+=b[c].textContent;return a}if(this.clear().build(!0),"function"==typeof a)a.call(this,this);else{a=a.split("\n");for(var c=0,e=a.length;e>c;c++)this.tspan(a[c]).newLine()}return this.build(!1).rebuild()},size:function(a){return this.attr("font-size",a).rebuild()},leading:function(a){return null==a?this.dom.leading:(this.dom.leading=new s.Number(a),this.rebuild())},lines:function(){var a=s.utils.map(s.utils.filterSVGElements(this.node.childNodes),function(a){return s.adopt(a)});return new s.Set(a)},rebuild:function(a){if("boolean"==typeof a&&(this._rebuild=a),this._rebuild){var b=this,c=0,d=this.dom.leading*new s.Number(this.attr("font-size"));this.lines().each(function(){this.dom.newLined&&(this.textPath||this.attr("x",b.attr("x")),"\n"==this.text()?c+=d:(this.attr("dy",d+c),c=0))}),this.fire("rebuild")}return this},build:function(a){return this._build=!!a,this},setData:function(a){return this.dom=a,this.dom.leading=new s.Number(a.leading||1.3),this}},construct:{text:function(a){return this.put(new s.Text).text(a)},plain:function(a){return this.put(new s.Text).plain(a)}}}),s.Tspan=s.invent({create:"tspan",inherit:s.Shape,extend:{text:function(a){return null==a?this.node.textContent+(this.dom.newLined?"\n":""):("function"==typeof a?a.call(this,this):this.plain(a),this)},dx:function(a){return this.attr("dx",a)},dy:function(a){return this.attr("dy",a)},newLine:function(){var a=this.parent(s.Text);return this.dom.newLined=!0,this.dy(a.dom.leading*a.attr("font-size")).attr("x",a.x())}}}),s.extend(s.Text,s.Tspan,{plain:function(a){return this._build===!1&&this.clear(),this.node.appendChild(b.createTextNode(a)),this},tspan:function(a){var b=(this.textPath&&this.textPath()||this).node,c=new s.Tspan;return this._build===!1&&this.clear(),b.appendChild(c.node),c.text(a)},clear:function(){for(var a=(this.textPath&&this.textPath()||this).node;a.hasChildNodes();)a.removeChild(a.lastChild);return this},length:function(){return this.node.getComputedTextLength()}}),s.TextPath=s.invent({create:"textPath",inherit:s.Element,parent:s.Text,construct:{path:function(a){for(var b=new s.TextPath,c=this.doc().defs().path(a);this.node.hasChildNodes();)b.node.appendChild(this.node.firstChild);return this.node.appendChild(b.node),b.attr("href","#"+c,s.xlink),this},plot:function(a){var b=this.track();return b&&b.plot(a),this},track:function(){var a=this.textPath();return a?a.reference("href"):void 0},textPath:function(){return this.node.firstChild&&"textPath"==this.node.firstChild.nodeName?s.adopt(this.node.firstChild):void 0}}}),s.Nested=s.invent({create:function(){this.constructor.call(this,s.create("svg")),this.style("overflow","visible")},inherit:s.Container,construct:{nested:function(){return this.put(new s.Nested)}}}),s.A=s.invent({create:"a",inherit:s.Container,extend:{to:function(a){return this.attr("href",a,s.xlink)},show:function(a){return this.attr("show",a,s.xlink)},target:function(a){return this.attr("target",a)}},construct:{link:function(a){return this.put(new s.A).to(a)}}}),s.extend(s.Element,{linkTo:function(a){var b=new s.A;return"function"==typeof a?a.call(b,b):b.to(a),this.parent().put(b).put(this)}}),s.Marker=s.invent({create:"marker",inherit:s.Container,extend:{width:function(a){return this.attr("markerWidth",a)},height:function(a){return this.attr("markerHeight",a)},ref:function(a,b){return this.attr("refX",a).attr("refY",b)},update:function(a){return this.clear(),"function"==typeof a&&a.call(this,this),this},toString:function(){return"url(#"+this.id()+")"}},construct:{marker:function(a,b,c){return this.defs().marker(a,b,c)}}}),s.extend(s.Defs,{marker:function(a,b,c){return this.put(new s.Marker).size(a,b).ref(a/2,b/2).viewbox(0,0,a,b).attr("orient","auto").update(c)}}),s.extend(s.Line,s.Polyline,s.Polygon,s.Path,{marker:function(a,b,c,d){var e=["marker"];return"all"!=a&&e.push(a),e=e.join("-"),a=arguments[1]instanceof s.Marker?arguments[1]:this.doc().marker(b,c,d),this.attr(e,a)}});var t={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(a,b){return"color"==b?a:a+"-"+b}};["fill","stroke"].forEach(function(a){var b,c={};c[a]=function(c){if("string"==typeof c||s.Color.isRgb(c)||c&&"function"==typeof c.fill)this.attr(a,c);else for(b=t[a].length-1;b>=0;b--)null!=c[t[a][b]]&&this.attr(t.prefix(a,t[a][b]),c[t[a][b]]);return this},s.extend(s.Element,s.FX,c)}),s.extend(s.Element,s.FX,{rotate:function(a,b,c){return this.transform({rotation:a,cx:b,cy:c})},skew:function(a,b,c,d){return this.transform({skewX:a,skewY:b,cx:c,cy:d})},scale:function(a,b,c,d){return 1==arguments.length||3==arguments.length?this.transform({scale:a,cx:b,cy:c}):this.transform({scaleX:a,scaleY:b,cx:c,cy:d})},translate:function(a,b){return this.transform({x:a,y:b})},flip:function(a,b){return this.transform({flip:a,offset:b})},matrix:function(a){return this.attr("transform",new s.Matrix(a))},opacity:function(a){return this.attr("opacity",a)},dx:function(a){return this.x((this.target||this).x()+a)},dy:function(a){return this.y((this.target||this).y()+a)},dmove:function(a,b){return this.dx(a).dy(b)}}),s.extend(s.Rect,s.Ellipse,s.Circle,s.Gradient,s.FX,{radius:function(a,b){var c=(this.target||this).type;return"radial"==c||"circle"==c?this.attr({r:new s.Number(a)}):this.rx(a).ry(null==b?a:b)}}),s.extend(s.Path,{length:function(){return this.node.getTotalLength()},pointAt:function(a){return this.node.getPointAtLength(a)}}),s.extend(s.Parent,s.Text,s.FX,{font:function(a){for(var b in a)"leading"==b?this.leading(a[b]):"anchor"==b?this.attr("text-anchor",a[b]):"size"==b||"family"==b||"weight"==b||"stretch"==b||"variant"==b||"style"==b?this.attr("font-"+b,a[b]):this.attr(b,a[b]);return this}}),s.Set=s.invent({create:function(a){Array.isArray(a)?this.members=a:this.clear()},extend:{add:function(){var a,b,c=[].slice.call(arguments);for(a=0,b=c.length;b>a;a++)this.members.push(c[a]);return this},remove:function(a){var b=this.index(a);return b>-1&&this.members.splice(b,1),this},each:function(a){for(var b=0,c=this.members.length;c>b;b++)a.apply(this.members[b],[b,this.members]);return this},clear:function(){return this.members=[],this},length:function(){return this.members.length},has:function(a){return this.index(a)>=0},index:function(a){return this.members.indexOf(a)},get:function(a){return this.members[a]},first:function(){return this.get(0)},last:function(){return this.get(this.members.length-1)},valueOf:function(){return this.members},bbox:function(){var a=new s.BBox;if(0==this.members.length)return a;var b=this.members[0].rbox();return a.x=b.x,a.y=b.y,a.width=b.width,a.height=b.height,this.each(function(){a=a.merge(this.rbox())}),a}},construct:{set:function(a){return new s.Set(a)}}}),s.FX.Set=s.invent({create:function(a){this.set=a}}),s.Set.inherit=function(){var a,b=[];for(var a in s.Shape.prototype)"function"==typeof s.Shape.prototype[a]&&"function"!=typeof s.Set.prototype[a]&&b.push(a);b.forEach(function(a){s.Set.prototype[a]=function(){for(var b=0,c=this.members.length;c>b;b++)this.members[b]&&"function"==typeof this.members[b][a]&&this.members[b][a].apply(this.members[b],arguments);return"animate"==a?this.fx||(this.fx=new s.FX.Set(this)):this}}),b=[];for(var a in s.FX.prototype)"function"==typeof s.FX.prototype[a]&&"function"!=typeof s.FX.Set.prototype[a]&&b.push(a);b.forEach(function(a){s.FX.Set.prototype[a]=function(){for(var b=0,c=this.set.members.length;c>b;b++)this.set.members[b].fx[a].apply(this.set.members[b].fx,arguments);return this}})},s.extend(s.Element,{data:function(a,b,c){if("object"==typeof a)for(b in a)this.data(b,a[b]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+a))}catch(d){return this.attr("data-"+a)}else this.attr("data-"+a,null===b?null:c===!0||"string"==typeof b||"number"==typeof b?b:JSON.stringify(b));return this}}),s.extend(s.Element,{remember:function(a,b){if("object"==typeof arguments[0])for(var b in a)this.remember(b,a[b]);else{if(1==arguments.length)return this.memory()[a];this.memory()[a]=b}return this},forget:function(){if(0==arguments.length)this._memory={};else for(var a=arguments.length-1;a>=0;a--)delete this.memory()[arguments[a]];return this},memory:function(){return this._memory||(this._memory={})}}),s.get=function(a){var c=b.getElementById(r(a)||a);return s.adopt(c)},s.select=function(a,c){return new s.Set(s.utils.map((c||b).querySelectorAll(a),function(a){return s.adopt(a)}))},s.extend(s.Parent,{select:function(a){return s.select(a,this.node)}});var u="abcdef".split("");if("function"!=typeof v){var v=function(a,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var d=b.createEvent("CustomEvent");return d.initCustomEvent(a,c.bubbles,c.cancelable,c.detail),d};v.prototype=a.Event.prototype,a.CustomEvent=v}return function(b){for(var c=0,d=["moz","webkit"],e=0;e<d.length&&!a.requestAnimationFrame;++e)b.requestAnimationFrame=b[d[e]+"RequestAnimationFrame"],b.cancelAnimationFrame=b[d[e]+"CancelAnimationFrame"]||b[d[e]+"CancelRequestAnimationFrame"];b.requestAnimationFrame=b.requestAnimationFrame||function(a){var d=(new Date).getTime(),e=Math.max(0,16-(d-c)),f=b.setTimeout(function(){a(d+e)},e);return c=d+e,f},b.cancelAnimationFrame=b.cancelAnimationFrame||b.clearTimeout}(a),s}),function(){function a(a){a.remember("_draggable",this),this.el=a}a.prototype.init=function(a,b){var c=this;this.constraint=a,this.value=b,this.el.on("mousedown.drag",function(a){c.start(a)}),this.el.on("touchstart.drag",function(a){c.start(a)})},a.prototype.transformPoint=function(a,b){a=a||window.event;var c=a.changedTouches&&a.changedTouches[0]||a;return this.p.x=c.pageX-(b||0),this.p.y=c.pageY,this.p.matrixTransform(this.m)},a.prototype.getBBox=function(){var a=this.el.bbox();return this.el instanceof SVG.Nested&&(a=this.el.rbox()),(this.el instanceof SVG.G||this.el instanceof SVG.Use||this.el instanceof SVG.Nested)&&(a.x=this.el.x(),a.y=this.el.y()),a},a.prototype.start=function(a){if("click"!=a.type&&"mousedown"!=a.type&&"mousemove"!=a.type||1==(a.which||a.buttons)){var b=this;this.el.fire("beforedrag",{event:a,handler:this}),this.parent=this.parent||this.el.parent(SVG.Nested)||this.el.parent(SVG.Doc),this.p=this.parent.node.createSVGPoint(),this.m=this.el.node.getScreenCTM().inverse();var c,d=this.getBBox();if(this.el instanceof SVG.Text)switch(c=this.el.node.getComputedTextLength(),this.el.attr("text-anchor")){case"middle":c/=2;break;case"start":c=0}this.startPoints={point:this.transformPoint(a,c),box:d},SVG.on(window,"mousemove.drag",function(a){b.drag(a)}),SVG.on(window,"touchmove.drag",function(a){b.drag(a)}),SVG.on(window,"mouseup.drag",function(a){b.end(a)}),SVG.on(window,"touchend.drag",function(a){b.end(a)}),this.el.fire("dragstart",{event:a,p:this.startPoints.point,m:this.m,handler:this}),a.preventDefault(),a.stopPropagation()}},a.prototype.drag=function(a){var b=this.getBBox(),c=this.transformPoint(a),d=this.startPoints.box.x+c.x-this.startPoints.point.x,e=this.startPoints.box.y+c.y-this.startPoints.point.y,f=this.constraint;if(this.el.fire("dragmove",{event:a,p:c,m:this.m,handler:this}),"function"==typeof f){var g=f.call(this.el,d,e,this.m);"boolean"==typeof g&&(g={x:g,y:g}),g.x===!0?this.el.x(d):g.x!==!1&&this.el.x(g.x),g.y===!0?this.el.y(e):g.y!==!1&&this.el.y(g.y)}else"object"==typeof f&&(null!=f.minX&&d<f.minX?d=f.minX:null!=f.maxX&&d>f.maxX-b.width&&(d=f.maxX-b.width),null!=f.minY&&e<f.minY?e=f.minY:null!=f.maxY&&e>f.maxY-b.height&&(e=f.maxY-b.height),this.el.move(d,e));return c},a.prototype.end=function(a){var b=this.drag(a);this.el.fire("dragend",{event:a,p:b,m:this.m,handler:this}),SVG.off(window,"mousemove.drag"),SVG.off(window,"touchmove.drag"),SVG.off(window,"mouseup.drag"),SVG.off(window,"touchend.drag")},SVG.extend(SVG.Element,{draggable:function(b,c){("function"==typeof b||"object"==typeof b)&&(c=b,b=!0);var d=this.remember("_draggable")||new a(this);return b="undefined"==typeof b?!0:b,b?d.init(c||{},b):(this.off("mousedown.drag"),this.off("touchstart.drag")),this}})}.call(this),function(){SVG.math={angle:function(a,b,c){if(c)return Math.abs(SVG.math.angle(a,c)-SVG.math.angle(b,c));for(var d=Math.atan2(b.y-a.y,b.x-a.x);0>d;)d+=2*Math.PI;return d},rad:function(a){return a*Math.PI/180},deg:function(a){return 180*a/Math.PI},snapToAngle:function(a,b){var c,d,e,f=100;for(b.push(Math.min.apply(Math,b)+2*Math.PI),e=b.length;a>2*Math.PI;)a-=2*Math.PI;for(;0>a;)a+=2*Math.PI;for(d=0;e>d;d+=1){if(c=Math.abs(a-b[d]),c>f)return b[d-1];f=c}return b[0]},lerp:function(a,b,c){return a+c*(b-a)},round:function(a,b){return b=Math.pow(10,b||0).toFixed(0>b?-b:0),Math.round(a*b)/b}},SVG.math.Point=function(a,b){this.x=parseFloat(a),this.y=parseFloat(b)},SVG.extend(SVG.math.Point,{round:function(a){return this.x=SVG.math.round(this.x,a),this.y=SVG.math.round(this.y,a),this}}),SVG.math.Point.attr={stroke:"#000",fill:"none",radius:5},SVG.extend(SVG.math.Point,{draw:function(a,b){if(a){attr=b||SVG.math.Point.attr,b=b||{};var c=attr.radus||5;delete attr.radius,this.svg=a,this.circle=a.circle(c).attr(b).move(this.x,this.y)}else this.circle&&(this.circle.remove(),delete this.svg,delete this.circle);return this}}),SVG.math.Line=function(a,b){this.update(a,b)},SVG.math.Line.attr={stroke:"#000",fill:"none"},SVG.extend(SVG.math.Line,{update:function(a,b){return this.p1=a,this.p2=b,this.a=this.p2.y-this.p1.y,this.b=this.p1.x-this.p2.x,this.c=a.x*b.y-b.x*a.y,this},draw:function(a,b){return a?(attr=attr||SVG.math.Line.attr,this.svg=a,this.line=a.line(p1.x,p1.y,p2.x,p2.y).attr(b)):this.line&&(this.line.remove(),delete this.svg,delete this.line),this},angle:function(){return SVG.math.angle(this.p1,this.p2)},snapToAngle:function(a){var b=this.angle(),c=this.segmentLength();b-=b%a;var d=c*Math.cos(b),e=c*Math.sin(b);return this.update(this.p1,new SVG.math.Point(d,e))},parallel:function(a){return this.a*a.b-a.a*this.b===0},round:function(a){return this.p1.x=SVG.math.round(this.p1.x,a),this.p1.y=SVG.math.round(this.p1.y,a),this.p2.x=SVG.math.round(this.p2.x,a),this.p2.y=SVG.math.round(this.p2.y,a),this},move:function(a,b,c){var d=a.x>b.x?-1:a.x<b.x?1:(a.y>b.y,1),e=Math.atan((this.p1.y-this.p2.y)/(this.p1.x-this.p2.x)),f=c*Math.sin(e),g=c*Math.cos(e);return new SVG.math.Point(a.x+d*g,a.y+d*f)},intersection:function(a){var b=this.a*a.b-a.a*this.b,c=new SVG.math.Point((a.b*this.c-this.b*a.c)/b,(this.a*a.c-a.a*this.c)/b);return c.parallel=0===b,c},midPoint:function(){return this.interpolatedPoint(.5)},segmentLegth:function(){return Math.sqrt(this.segmentLengthSquared())},segmentLengthSquared:function(){var a=this.p2.x-this.p1.x,b=this.p2.y-this.p1.y;return a*a+b*b},closestLinearInterpolation:function(a){var b=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y;return((a.x-this.p1.x)*b+(a.y-this.p1.y)*c)/this.segmentLengthSquared()},interpolatedPoint:function(a){return{x:SVG.math.lerp(this.p1.x,this.p2.x,a),y:SVG.math.lerp(this.p1.y,this.p2.y,a)}},closestPoint:function(a){return this.interpolatedPoint(this.closestLinearInterpolation(a))},perpendicularLine:function(a,b){var c=this.p1.x-this.p2.x,d=this.p1.y-this.p2.y,e=Math.sqrt(c*c+d*d);return c/=e,d/=e,new SVG.math.Line(new SVG.math.Point(a.x+b*d,a.y-b*c),new SVG.math.Point(a.x-b*d,a.y+b*c))}})}(),function(){SVG.extend(SVG.Path,{M:function(a){return a=1===arguments.length?[a.x,a.y]:Array.prototype.slice.call(arguments),this.addSegment("M",a,!1),1===this._segments.length?this.plot("M"+a[0]+" "+a[1]):this},m:function(a){return a=1===arguments.length?[a.x,a.y]:Array.prototype.slice.call(arguments),this.addSegment("m",a,!1),1===this._segments.length?this.plot("m"+a[0]+" "+a[1]):this},L:function(a){return a=1===arguments.length?[a.x,a.y]:Array.prototype.slice.call(arguments),this.addSegment("L",a,this._redrawEnabled)},l:function(a){return a=1===arguments.length?[a.x,a.y]:Array.prototype.slice.call(arguments),this.addSegment("l",a,this._redrawEnabled)},H:function(a){return this.addSegment("H",[a],this._redrawEnabled)},h:function(a){return this.addSegment("h",[a],this._redrawEnabled)},V:function(a){return this.addSegment("V",[a],this._redrawEnabled)},v:function(a){return this.addSegment("v",[a],this._redrawEnabled)},C:function(a,b,c){return c=3===arguments.length?[a.x,a.y,b.x,b.y,c.x,c.y]:Array.prototype.slice.call(arguments),this.addSegment("C",c,this._redrawEnabled)},c:function(a,b,c){return c=3===arguments.length?[a.x,a.y,b.x,b.y,c.x,c.y]:Array.prototype.slice.call(arguments),this.addSegment("c",c,this._redrawEnabled)},S:function(a,b){return b=2===arguments.length?[a.x,a.y,b.x,b.y]:Array.prototype.slice.call(arguments),this.addSegment("S",b,this._redrawEnabled)},s:function(a,b){return b=2===arguments.length?[a.x,a.y,b.x,b.y]:Array.prototype.slice.call(arguments),this.addSegment("s",b,this._redrawEnabled)},Q:function(a,b){return b=2===arguments.length?[a.x,a.y,b.x,b.y]:Array.prototype.slice.call(arguments),this.addSegment("Q",b,this._redrawEnabled)},q:function(a,b){return b=2===arguments.length?[a.x,a.y,b.x,b.y]:Array.prototype.slice.call(arguments),this.addSegment("q",b,this._redrawEnabled)},T:function(a){return a=1===arguments.length?[a.x,a.y]:Array.prototype.slice.call(arguments),this.addSegment("T",a,this._redrawEnabled)},t:function(a){return a=1===arguments.length?[a.x,a.y]:Array.prototype.slice.call(arguments),this.addSegment("t",a,this._redrawEnabled)},A:function(a,b,c,d,e,f){return f=6===arguments.length?[a,b,c,d,e,f.x,f.y]:Array.prototype.slice.call(arguments),this.addSegment("A",f,this._redrawEnabled)},a:function(a,b,c,d,e,f){return f=6===arguments.length?[a,b,c,d,e,f.x,f.y]:Array.prototype.slice.call(arguments),this.addSegment("a",f,this._redrawEnabled)},Z:function(){return this.addSegment("Z",[],this._redrawEnabled)},addSegment:function(a,b,c){var d={type:a,coords:b};return this._segments||(this._segments=[]),this._segments.push(d),c!==!1&&this._drawSegment(d),this},clear:function(){return this._segments&&(this._segments.length=0),this._lastSegment=null,this.plot()},getSegmentCount:function(){return this._segments.lenght},getSegment:function(a){return this._segments[a]},removeSegment:function(a){return this._segments.splice(a,1),this.redraw()},replaceSegment:function(a,b){return this._segments.splice(a,1,b),this.redraw()},redraw:function(){return this._lastSegment=null,this.attr("d",""),this._drawSegment(this._segments)},_drawSegment:function(a){var b="",c=this._lastSegment;Array.isArray(a)||(a=[a]);for(var d=0;d<a.length;d+=1)b+=c===a[d].type?" "+a[d].coords.join(" "):" "+a[d].type+a[d].coords.join(" "),c=a[d].type;return this._lastSegment=c,this.attr("d",this.attr("d")+b)},line:function(a,b){var c=networkMap.Point;
return b&&b.reset?this.M(new c(a.p1.x,a.p1.y)):this.L(new c(a.p1.x,a.p1.y)),this.L(new c(a.p2.x,a.p2.y)),this}})}.call(this),"document"in self&&!("classList"in document.createElement("_"))&&!function(a){"use strict";if("Element"in a){var b="classList",c="prototype",d=a.Element[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(""===b)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){for(var b=f.call(a.getAttribute("class")||""),c=b?b.split(/\s+/):[],d=0,e=c.length;e>d;d++)this.push(c[d]);this._updateClassName=function(){a.setAttribute("class",this.toString())}},k=j[c]=[],l=function(){return new j(this)};if(h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",-1!==i(this,a)},k.add=function(){var a,b=arguments,c=0,d=b.length,e=!1;do a=b[c]+"",-1===i(this,a)&&(this.push(a),e=!0);while(++c<d);e&&this._updateClassName()},k.remove=function(){var a,b=arguments,c=0,d=b.length,e=!1;do{a=b[c]+"";var f=i(this,a);-1!==f&&(this.splice(f,1),e=!0)}while(++c<d);e&&this._updateClassName()},k.toggle=function(a,b){a+="";var c=this.contains(a),d=c?b!==!0&&"remove":b!==!1&&"add";return d&&this[d](a),!c},k.toString=function(){return this.join(" ")},e.defineProperty){var m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(n){-2146823252===n.number&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}}(self);var networkMap=networkMap||{};networkMap.path=function(a){return a.path().attr({fill:"none",stroke:"#000"})},networkMap.find=function(a,b){for(var c=0,d=a.length;d>c;c++)if(b.call(a,a[c],c,a))return a[c]},networkMap.isFunction=function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},networkMap.extend=function(){var a,b,c,d;for(a=[].slice.call(arguments),b=a.pop(),d=a.length-1;d>=0;d--)if(a[d])for(c in b)a[d].prototype[c]=b[c]},networkMap.Observable=function(){function a(a){return a.replace(/^on([A-Z])/,function(a,b){return b.toLowerCase()})}return{addEvent:function(b,c){return this.$events=this.$events||{},networkMap.isFunction(c)?(b=a(b),(this.$events[b]=this.$events[b]||[]).push(c),this):this},addEvents:function(a){for(var b in a)this.addEvent(b,a[b]);return this},fireEvent:function(b,c,d){this.$events=this.$events||{},b=a(b);var e=this.$events[b];return e?(c=c instanceof Array?c:[c],e.forEach(function(a){d?setTimeout(function(){a.apply(this,c)},d):a.apply(this,c)},this),this):this},removeEvent:function(b,c){b=a(b);var d=this.$events[b]||[],e=d.indexOf(c);return-1!==e&&d.splice(e,1),this},removeEvents:function(b){var c;if("object"==typeof b){for(c in b)this.removeEvent(c,b[c]);return this}b&&(b=a(b));for(c in this.$events)if(!b||b==c)for(var d=this.$events[c],e=d.length;e--;)e in d&&this.removeEvent(c,d[e]);return this}}}(),networkMap.keys=function(a){var b,c=[];if(a!==Object(a))return c;if(Object.keys)return Object.keys(a);for(b in a)hasOwnProperty.call(a,b)&&c.push(b);return c},networkMap.each=function(a,b,c){var d,e;if(null===a)return a;if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(b,c);else if(a.length===+a.length)for(d=0,e=a.length;e>d;d++)b.call(c,a[d],d,a);else{var f=networkMap.keys(a);for(d=0,e=f.length;e>d;d++)b.call(c,a[f[d]],f[d],a)}return a},networkMap.defaults=function(a){return a=a||{},networkMap.each(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},networkMap.Options={setOptions:function(a){return this.options=networkMap.defaults(a,this.options),this}},networkMap.Mediator={subscribe:function(a,b){return networkMap.isFunction(b)?(this.$topics=this.$topics||{},(this.$topics[a]=this.$topics[a]||[]).push(b),this):this},publish:function(a,b,c){this.$topics=this.$topics||{};var d=this.$topics[a];return d?(b=b instanceof Array?b:[b],d.forEach(function(a){c?setTimeout(function(){a.apply(this,b)},c):a.apply(this,b)},this),this):this},unsubscribe:function(a,b){var c=this.$topics[a],d=c.indexOf(b);return-1!==d&&c.splice(d,1),this}},networkMap.toQueryString=function(a,b){var c=[];return networkMap.each(a,function(a,d){b&&(d=b+"["+d+"]");var e;switch(typeof a){case"object":e=networkMap.toQueryString(a,d);break;case"array":var f={};a.forEach(function(a,b){f[b]=a}),e=networkMap.toQueryString(f,d);break;default:e=d+"="+encodeURIComponent(a)}null!=a&&c.push(e)}),c.join("&")},networkMap.vec2=SVG.math.Point,SVG.math.Point.create=function(a,b){return new SVG.math.Point(a,b)},SVG.extend(SVG.math.Point,{clone:function(){return SVG.math.Point.create(this.x,this.y)},add:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this},distance:function(a){var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},len:function(){var a=this.x,b=this.y;return Math.sqrt(a*a+b*b)},normalize:function(){var a=this.x,b=this.y,c=a*a+b*b;return c>0&&(c=1/Math.sqrt(c),this.x=a*c,this.y=b*c),this},angle:function(){for(var a=Math.atan2(this.y,this.x);0>a;)a+=2*Math.PI;return a},maxDir:function(){var a=this.x,b=this.y,c=Math.abs(a),d=Math.abs(b);return c>d?(this.x=a/c,this.y=0):(this.x=0,this.y=b/d),this},roundDir:function(a){var b=this.angle(),c=this.len();return b-=b%a,this.x=c*Math.cos(b),this.y=c*Math.sin(b),this},scale:function(a){return this.x*=a,this.y*=a,this},mul:function(a){return this.x*=a.x,this.y*=a.y,this},confine:function(a){var b=this.x,c=this.y,d=a.x,e=a.y;return this.x=Math.abs(b)<Math.abs(d)?b:b/Math.abs(b)*d,this.y=Math.abs(c)<Math.abs(e)?c:c/Math.abs(c)*e,this}}),networkMap.event=networkMap.event||{},networkMap.event.Configuration=function(a){this.deletable=a.deletable?!0:!1,this._destroy=a.destroy?a.destroy:function(){return!1},this._cancel=a.cancel?a.cancel:function(){return!1},this.editable=a.editable?!0:!1,this.editWidget=a.editWidget?a.editWidget:null,this.target=a.target?a.target:null,this.type=a.type?a.type:"unknown",this.configWidget=this.editWidget},networkMap.extend(networkMap.event.Configuration,{destroy:function(){return this._destroy()},cancel:function(){return this._cancel()}}),networkMap.widget=networkMap.widget||{},networkMap.widget.IntegerInput=function(a,b,c){this.options={"class":"nm-input-integer"},this.setOptions(c),this.createElements(a,b)},networkMap.extend(networkMap.widget.IntegerInput,networkMap.Observable),networkMap.extend(networkMap.widget.IntegerInput,networkMap.Options),networkMap.extend(networkMap.widget.IntegerInput,{createElements:function(a,b){return this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options["class"]),this.label=document.createElement("span"),this.label.textContent=a,this.input=document.createElement("input"),this.input.setAttribute("type","number"),this.input.value=b.inherited&&b.value?b.value:b.inherited?"":b?b:"",b.inherited&&this.input.setAttribute("placeholder",b.inherited),this.input.addEventListener("change",function(a){a.value=this.value();var b=this;setTimeout(function(){b.fireEvent("change",[a,b])},1)}.bind(this)),void 0!==this.options.min&&this.input.setAttribute("min",this.options.min),this.options.disabled===!0&&(this.input.disabled=!0),this.wrapper.appendChild(this.label),this.wrapper.appendChild(this.input),this},toElement:function(){return this.wrapper},value:function(){return""!==this.input.value?parseInt(this.input.value):void 0}}),networkMap.widget=networkMap.widget||{},networkMap.widget.TextInput=function(a,b,c){this.options={"class":"nm-input-text",type:"text"},this.setOptions(c),this.$destroy=[],this.createElements(a,b)},networkMap.extend(networkMap.widget.TextInput,networkMap.Observable),networkMap.extend(networkMap.widget.TextInput,networkMap.Options),networkMap.extend(networkMap.widget.TextInput,{createElements:function(a,b){var c=this.wrapper=document.createElement("div");c.classList.add(this.options["class"]);var d=this.label=document.createElement("span");d.textContent=a;var e=this.input=document.createElement("input"),f=function(a){this.fireEvent("change",[a,this])}.bind(this);return e.setAttribute("type",this.options.type),e.setAttribute("value",b?b:""),this.$destroy.push({el:e,type:"change",fn:f}),e.addEventListener("change",f,!1),this.options.disabled===!0&&(this.input.disabled=!0),c.appendChild(d),c.appendChild(e),this},value:function(){return""!==this.input.value?this.input.value:void 0},toElement:function(){return this.wrapper}}),networkMap.widget=networkMap.widget||{},networkMap.widget.ColorInput=function(a,b,c){this.options={"class":"nm-input-color"},this.setOptions(c),this.createElements(a,b)},networkMap.extend(networkMap.widget.ColorInput,networkMap.Observable),networkMap.extend(networkMap.widget.ColorInput,networkMap.Options),networkMap.extend(networkMap.widget.ColorInput,{createElements:function(a,b){this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options["class"]),this.label=document.createElement("span"),this.label.textContent=a,this.div=document.createElement("div"),this.input=document.createElement("input"),this.input.setAttribute("type","color"),this.input.setAttribute("value",b),this.input.addEventListener("change",function(a){this.fireEvent("change",[a,this])}.bind(this)),this.options.disabled===!0&&(this.input.disabled=!0),this.div.appendChild(this.input),this.wrapper.appendChild(this.label),this.wrapper.appendChild(this.div)},value:function(){return this.input.value},toElement:function(){return this.wrapper}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Accordion=function(a){this.options={"class":"nm-accordion"},this.setOptions(a),this.items=[],this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options["class"])},networkMap.extend(networkMap.widget.Accordion,networkMap.Observable),networkMap.extend(networkMap.widget.Accordion,networkMap.Options),networkMap.extend(networkMap.widget.Accordion,{toElement:function(){return this.wrapper},add:function(a,b){var c=document.createElement("div");c.classList.add("nm-accordion-group","nm-accordion-open");var d=document.createElement("div");d.classList.add("nm-accordion-trigger","unselectable"),d.textContent=a;var e=new networkMap.widget.Accordion.Group(b);return c.appendChild(d),c.appendChild(e.toElement()),this.items.push(c),this.wrapper.appendChild(c),d.addEventListener("click",this.clickHandler.bind(this)),e},clickHandler:function(a){a.target.parentNode.classList.toggle("nm-accordion-open")}}),networkMap.widget.Accordion.Group=function(a){var b=this.list=document.createElement("ul");b.classList.add("nm-accordion-inner"),a&&a.id&&b.setAttribute("id",a.id)},networkMap.extend(networkMap.widget.Accordion.Group,{appendChild:function(a){return a.toElement?this.list.appendChild(a.toElement()):this.list.appendChild(a),this},toElement:function(){return this.list}}),networkMap.widget=networkMap.widget||{},networkMap.widget.List=function(a){this.options={"class":"nm-list"},this.listItems=[],this.setOptions(a),this.list=document.createElement("ul"),this.list.classList.add(this.options["class"])},networkMap.extend(networkMap.widget.List,networkMap.Observable),networkMap.extend(networkMap.widget.List,networkMap.Options),networkMap.extend(networkMap.widget.List,{toElement:function(){return this.list},add:function(a,b){var c=new networkMap.widget.ListItem(a,b);return c.addEvent("remove",this.remove.bind(this)),this.listItems.push(c),this.list.appendChild(c.toElement()),c},remove:function(a){var b=this.listItems.indexOf(a);return this.listItems.splice(b,1),this}}),networkMap.widget.ListItem=function(a,b){if(this.options={"class":"nm-list-item",enableDelete:!1},this.setOptions(b),this.listItem=document.createElement("li"),this.listItem.classList.add(this.options["class"]),"string"==typeof a?this.listItem.textContent=a:this.listItem.appechChild(a),this.options.enableDelete){var c=document.createElement("span");c.textContent="x",c.classList.add("nm-list-item-delete","pull-right"),this.$remove=this.remove.bind(this),c.addEventListener("click",this.$remove),this.listItem.appendChild(c)}},networkMap.extend(networkMap.widget.ListItem,networkMap.Observable),networkMap.extend(networkMap.widget.ListItem,networkMap.Options),networkMap.extend(networkMap.widget.ListItem,{remove:function(){return this.listItem.parentNode.removeChild(this.listItem),this.listItem.removeEventListener("click",this.$remove),delete this.listItem,this.fireEvent("remove",[this]),this},toElement:function(){return this.listItem}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Select=function(a,b,c){this.options={"class":"nm-input-select"},this.setOptions(c),this.$destroy=[],this.createElements(a),this.addOptions(b)},networkMap.extend(networkMap.widget.Select,networkMap.Observable),networkMap.extend(networkMap.widget.Select,networkMap.Options),networkMap.extend(networkMap.widget.Select,{createElements:function(a){var b=this.wrapper=document.createElement("div");b.classList.add(this.options["class"]);var c=this.label=document.createElement("span");c.textContent=a;var d=this.input=document.createElement("select"),e=function(a){this.fireEvent("select",[a,this])}.bind(this);this.$destroy.push({el:d,type:"change",fn:e}),d.addEventListener("change",e,!1),b.appendChild(c),b.appendChild(d)},addOptions:function(a){a.forEach(function(a){this.addOption(a)}.bind(this))},addOption:function(a,b){b=b||{};var c=document.createElement("option");return c.setAttribute("value",b.value?b.value:a),c.textContent=a,c.selected=b.selected,this.input.appendChild(c),c},value:function(){return this.getSelected()},getSelected:function(){return-1!==this.input.selectedIndex?this.input.options[this.input.selectedIndex].value:null},clearOptions:function(){for(;this.input.firstChild;)this.input.removeChild(this.input.firstChild);return this},toElement:function(){return this.wrapper},toString:function(){return-1!==this.input.selectedIndex?this.input.options[this.input.selectedIndex]:null}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Modal=function(a){this.options={"class":"modal",title:"",content:"",footer:"",type:"alert"},this.setOptions(a),this.$destroy=[],this.buildUI()},networkMap.extend(networkMap.widget.Modal,networkMap.Observable),networkMap.extend(networkMap.widget.Modal,networkMap.Options),networkMap.extend(networkMap.widget.Modal,{buildUI:function(){var a=this.modal=document.createElement("div");a.classList.add("modal","hide","fade","in"),a.style.zIndex=1e6;var b=this.header=document.createElement("div");b.classList.add("modal-header");var c=this.closeButton=document.createElement("button"),d=this._close.bind(this);c.classList.add("close"),c.innerHTML="&times;",this.$destroy.push({el:c,type:"click",fn:d}),c.addEventListener("click",d,!1),b.appendChild(c);var e=this.title=document.createElement("h3");e.innerHTML=this.options.title,b.appendChild(e);var f=this.body=document.createElement("div");f.classList.add("modal-body"),f.innerHTML=this.options.content;var g=this.footer=document.createElement("div");return g.classList.add("modal-footer"),g.innerHTML=this.options.footer,a.appendChild(b),a.appendChild(f),a.appendChild(g),this},alert:function(a,b){b=b||{},this.body.innerHTML=a,this.title.innerHTML=b.title?b.title:"Alert";var c=this.btn=document.createElement("a"),d=this.destroy.bind(this);return c.setAttribute("href","#"),c.classList.add("btn"),c.textContent=b.button?b.button:"Ok",this.$destroy.push({el:c,type:"click",fn:d}),c.addEventListener("click",d,!1),this.footer.appendChild(c),document.body.appendChild(this.modal),this.show()},confirm:function(a,b){b=b||{},this.body.innerHTML=a,this.title.innerHTML=b.title?b.title:"Alert";var c=document.createElement("a"),d=this._cancel.bind(this);c.setAttribute("href","#"),c.classList.add("btn"),c.textContent=b.button?b.button:"Ok",this.$destroy.push({el:c,type:"click",fn:d}),c.addEventListener("click",d,!1),this.footer.appendChild(c);var e=document.createElement("a"),f=this._cancel.bind(this);return e.setAttribute("href","#"),e.classList.add("btn"),e.textContent=b.button?b.button:"Ok",this.$destroy.push({el:e,type:"click",fn:f}),e.addEventListener("click",f,!1),this.footer.appendChild(e),document.body.appendChild(this.modal),this.show()},show:function(){return this.modal.style.display="block",this},destroy:function(){return this.modal.parentNode.removeChild(this.modal),this.$destroy.forEach(function(a){a.el.removeEventListener(a.type,a.fn,!1)}),this.$destroy.length=0,this},_close:function(a){this.fireEvent("close",[a]),this.destroy()},_ok:function(a){this.fireEvent("ok",[a]),this.destroy()},_cancel:function(a){this.fireEvent("cancel",[a]),this.destroy()}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Checkbox=function(a,b,c){this.options={"class":"nm-checkbox",type:"checkbox"},this.setOptions(c),this.createElements(a,b)},networkMap.extend(networkMap.widget.Checkbox,networkMap.Observable),networkMap.extend(networkMap.widget.Checkbox,networkMap.Options),networkMap.extend(networkMap.widget.Checkbox,{createElements:function(a,b){return this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options["class"]),this.label=document.createElement("span"),this.label.textContent=a,this.input=document.createElement("input"),this.input.setAttribute("type",this.options.type),this.input.checked=b,this.input.addEventListener("change",function(a){a.value=this.value(),this.fireEvent("change",[a,this])}.bind(this)),this.options.disabled===!0&&(this.input.disabled=!0),this.wrapper.appendChild(this.label),this.wrapper.appendChild(this.input),this},toElement:function(){return this.wrapper},value:function(){return this.input.checked},isChecked:function(){return this.input.checked}}),networkMap.widget=networkMap.widget||{},networkMap.widget.GridInput=function(a,b,c){this.options={"class":"nm-input-snap",type:"snap"},this.setOptions(c),this.createElements(a,b)},networkMap.extend(networkMap.widget.GridInput,networkMap.Observable),networkMap.extend(networkMap.widget.GridInput,networkMap.Options),networkMap.extend(networkMap.widget.GridInput,{createElements:function(a,b){this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options["class"]),this.label=document.createElement("span"),this.label.textContent=a,this.check=document.createElement("input"),this.check.setAttribute("type","checkbox"),this.check.checked=b.enabled,this.check.addEventListener("change",function(a){this.x.input.disabled=!this.check.checked,this.y.input.disabled=!this.check.checked,a.value=this.value(),this.fireEvent("change",[a])}.bind(this)),this.x=this.$createInputs("x",b.grid.x,b.enabled),this.y=this.$createInputs("y",b.grid.y,b.enabled),this.wrapper.appendChild(this.label),this.wrapper.appendChild(this.check),this.wrapper.appendChild(this.x.label),this.wrapper.appendChild(this.x.input),this.wrapper.appendChild(this.y.label),this.wrapper.appendChild(this.y.input)},$createInputs:function(a,b,c){var d={};return d.label=document.createElement("span"),d.label.textContent=a,d.input=document.createElement("input"),d.input.setAttribute("type","number"),d.input.setAttribute("value",b?b:1),d.input.setAttribute("min",1),d.input.setAttribute("max",50),d.input.disabled=!c,d.input.addEventListener("change",function(a){a.value=this.value(),this.fireEvent("change",[a,this])}.bind(this)),d},value:function(){return{enabled:this.check.checked,grid:{x:parseInt(this.x.input.value,10),y:parseInt(this.y.input.value,10)}}},toElement:function(){return this.wrapper}}),networkMap.Properties=function(a,b){this.properties=a||{},this.$change=[],this.setDefaults(b)},networkMap.extend(networkMap.Properties,networkMap.Observable),networkMap.extend(networkMap.Properties,{get:function(a,b){for(var c=this.properties,d=0,e=a.split("."),f=e.length;f>d&&(c&&"object"==typeof c);d++)c=c[e[d]];return b===!0?{value:c,inherited:this.defaults?this.defaults.get(a):void 0}:(void 0===c&&void 0!==this.defaults&&(c=this.defaults.get(a)),c)},set:function(a,b){return this.$change.length=0,1===arguments.length&&arguments[0].constructor===Object?networkMap.each(arguments[0],this.$set,this):this.$set(b,a),this.fireEvent("change",[this.$change]),this},$set:function(a,b){var c={key:b,value:a,oldValue:this.properties[b]};return this.properties[b]=a,this.$change.push(c),c},unset:function(a){var b=this.properties[a];return delete this.properties[a],this.fireEvent("change",[a,v,b]),this},load:function(a){var b=[],c=this.properties;return networkMap.each(a,function(a,d){b.push({key:a,value:d,oldValue:c[a]})}),this.properties=a,this.$change=b,this.fireEvent("change",[b]),this},extract:function(){return this.properties},setDefaults:function(a){this.defaults=a||void 0,this.defaults&&this.defaults.addEvent("change",function(a){this.fireEvent("change",[a])}.bind(this))},configuration:function(a){return a=a||{},void 0===this.defaults?networkMap.defaults(a,this.properties):networkMap.defaults(a,this.properties,this.defaults.configuration())}}),networkMap.datasource=networkMap.datasource||{},networkMap.registerDatasource=function(a,b){networkMap.datasource[a]=function(a,c){"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]),b(a,c)}},networkMap.registerDatasource("simulate",function(a,b){b.forEach(function(b){var c=Math.random();b.callback({url:a,request:b.link,value:c,realValue:Math.round(100*c)+"Mbps"})})}),networkMap.events=networkMap.events||{click:function(a,b){var c=b.properties.get("events");c&&c.click&&c.click.href&&(window.location.href=b.options.events.click.href)},hover:function(a,b,c){c.set("text",b.options.name)},mouseover:function(a,b,c){},mouseout:function(a,b,c){}},networkMap.registerEvent=function(a,b){if(!networkMap.events[a])throw"Invalid event: "+a+" is not an registered event";"click"===a?networkMap.events[a]=function(a,c){b(a,c)}:"hover"===a?(networkMap.events.mouseover=function(a,c){var d=document.getElementById("nm-active-hover");a.target.instance.attr("id");if(d){if(!d||d.retrieve("id")===a.target.instance.attr("id"))return void d.store("keep",!0);d.destroy()}d=new Element("div",{id:"nm-active-hover","class":"nm-hover",events:{mouseover:function(){d.store("mouseover",!0)},mouseout:function(){d.eliminate("mouseover"),function(){d.retrieve("keep")?d.eliminate("keep"):d.destroy()}.delay(10)},click:function(b){c._clickHandler(a)}}}).store("id",a.target.instance.attr("id")),d.setStyles({top:-1e3,left:-1e3}),document.id(document.body).grab(d),b(a,c,d);var e=d.getSize(),f=a.target.getBoundingClientRect();d.setStyles({top:(f.top+f.bottom)/2-e.y/2,left:(f.left+f.right)/2-e.x/2})},networkMap.events.mouseout=function(a,b){a.target.instance.link;(function(){var b=document.id("nm-active-hover");b&&b.retrieve("id")!==a.target.instance.attr("id")||b&&!b.retrieve("mouseover")&&b.destroy()}).delay(10)}):networkMap.events[a]=b},networkMap.registerEvent("click",networkMap.events.click),networkMap.registerEvent("mouseover",networkMap.events.mouseover),networkMap.registerEvent("mouseout",networkMap.events.mouseout),networkMap.registerEvent("hover",networkMap.events.hover),networkMap.colormap=networkMap.colormap||{},networkMap.registerColormap=function(a,b){networkMap.colormap[a]=b},networkMap.colormap.rasta5={translate:function(a){return a?.2>a?networkMap.colormap.rasta5.map[0]:.4>a?networkMap.colormap.rasta5.map[1]:.6>a?networkMap.colormap.rasta5.map[2]:.8>a?networkMap.colormap.rasta5.map[3]:networkMap.colormap.rasta5.map[4]:networkMap.colormap.rasta5.nodata},map:["#3DDE1E","#9BEC1A","#F9EB18","#F98020","#F51329"],limits:[.2,.4,.6,.8,1],nodata:"#C0C0C0"},networkMap.colormap.flat5={translate:function(a){var b=networkMap.colormap.flat5;return a||0===a?0===a?b.map[0]:.2>a?b.map[1]:.4>a?b.map[2]:.6>a?b.map[3]:.8>a?b.map[4]:b.map[5]:b.nodata},map:["#000000","#27ae60","#2ecc71","#f1c40f","#e67e22","#c0392b"],limits:[0,.2,.4,.6,.8,1],nodata:"#ecf0f1"},networkMap.colormap.hsl20={translate:function(a){var b=networkMap.colormap.hsl20;if(!a&&0!==a)return b.nodata;if(0===a)return"#000";var c=220-10*Math.floor(24*a);return 0>c&&(c=360-c),"hsl("+c+", 100%, 50%)"},map:["#000","#007fff","#0af","#00d4ff","#0ff","#0fa","#00ff80","#0f5","#00ff2b","#0f0","#5f0","#80ff00","#af0","#d4ff00","#ff0","#fa0","#ff8000","#f50","#ff2b00","#f00","#f05"],limits:[0,.05,.1,.15,.2,.25,.3,.35,.4,.45,.5,.55,.6,.65,.7,.75,.8,.85,.9,.95,1],nodata:"#ecf0f1"},networkMap.ColorLegend=function(a,b){if(this.options={boxSize:25,margin:10,target:null},this.graph=b.graph,delete b.graph,this.setOptions(b),this.colormap=networkMap.colormap[a],!this.colormap)throw'Colormap "'+a+'" is not registerd';this.draw(),setTimeout(function(){var a=this.svg.bbox();return 0===a.x&&0===a.y?this:void this._move()}.bind(this),0)},networkMap.extend(networkMap.ColorLegend,networkMap.Options),networkMap.extend(networkMap.ColorLegend,{graph:null,draw:function(){var a=this.colormap.map,b=this.container=this.wrapper=document.createElement("div");this.wrapper.classList.add("nm-colormap"),this.options.target.appendChild(b);var c=this.svg=this.svg||SVG(b).group();return this.svg.clear(),a.forEach(function(b,d){c.rect(this.options.boxSize,this.options.boxSize).attr({fill:b,"stroke-width":1}).move(0,(a.length-1-d)*this.options.boxSize),c.line(-5,(a.length-1-d)*this.options.boxSize,0,(a.length-1-d)*this.options.boxSize).attr({stroke:"#000"}),c.text(Math.round(100*this.colormap.limits[d].toString())+"%").attr({"text-anchor":"end","font-size":this.options.boxSize/2}).move(-this.options.boxSize/2,(a.length-1.3-d)*this.options.boxSize,"end")}.bind(this)),c.line(-5,a.length*this.options.boxSize,0,a.length*this.options.boxSize).attr({stroke:"#000"}),c.text("0%").attr({"text-anchor":"end","font-size":this.options.boxSize/2}).move(-this.options.boxSize/2,(a.length-.3)*this.options.boxSize,"end"),this._move(),this},_move:function(){var a=this.svg.bbox();return this.container.style.width=Math.ceil(a.width)+"px",this.container.style.height=Math.ceil(a.height)+"px",this.svg.move(Math.abs(a.x),Math.abs(a.y)),this}}),networkMap.SettingsManager=function(a,b,c){this.container=a,this.mediator=b,this.defaultView=c,this.editing=[],this.nav=this.createMenu(),a.appendChild(this.nav),this._actions={},this.mediator&&this.mediator.subscribe("edit",this.edit.bind(this))},networkMap.extend(networkMap.SettingsManager,networkMap.Observable),networkMap.extend(networkMap.SettingsManager,{createMenu:function(){var a=document.createElement("nav");a.classList.add("nm-menu");var b=document.createElement("div");b.classList.add("nm-trigger"),b.innerHTML='<span class="nm-icon nm-icon-menu"></span><a class="nm-label">Settings</a>',b.addEventListener("click",this.toggle.bind(this));var c=this.menu=document.createElement("ul"),d=this.contentContainer=document.createElement("li");d.classList.add("nm-object-properties"),d.setAttribute("id","nm-edit-content"),c.appendChild(d);var e=this.menuButtons=document.createElement("li");e.classList.add("clearfix","nm-menu-buttons");var f=this.btnSave=document.createElement("button");f.textContent="Save",f.classList.add("btn","btn-primary","pull-right"),f.addEventListener("click",this.save.bind(this));var g=this.btnAdd=document.createElement("button");g.textContent="Add",g.classList.add("btn","btn-success"),g.addEventListener("click",this.add.bind(this));var h=this.btnDelete=document.createElement("button");return h.textContent="Delete",h.classList.add("btn","btn-danger"),h.addEventListener("click",this["delete"].bind(this)),c.appendChild(e),e.appendChild(f),e.appendChild(g),e.appendChild(h),a.appendChild(b),a.appendChild(c),a},getContentContainer:function(){return this.contentContainer},edit:function(a){return a.editable?(this.purgeEditing(),this.configure(a)):void 0},clear:function(){for(var a=this.getContentContainer();a.firstChild;)a.removeChild(a.firstChild);return this},hideButtons:function(a){return this.menuButtons.setStyle("display","none"),this.showButtonsCallback=a?a:function(){},this},displayButtons:function(){return this.showButtonsCallback?(this.showButtonsCallback(),delete this.showButtonsCallback,this.menuButtons.style.display="block",this):this},purgeEditing:function(){var a=this.editing;a.forEach(function(a){a.configurationEvent().cancel(),a.purge()}),a.length=0},previousEdit:function(){var a=this.editing.pop();a&&a.purge();var b=this.editing.pop();return b?(this.clear(),this.displayButtons(),this.getContentContainer().appendChild(b.render()),this.editing.push(b),this):this.displayDefaultView()},setConfigWidget:function(a){return this.defaultView.configWidget=a,this.displayDefaultView(),this},displayDefaultView:function(){this.purgeEditing();var a=this.getContentContainer();return this.clear(),this.displayButtons(),this.defaultView.deletable?this.btnDelete.classList.remove("nm-hidden"):this.btnDelete.classList.add("nm-hidden"),a.appendChild(this.defaultView.configWidget.toElement()),this},toggle:function(){return this.nav.classList.contains("nm-menu-open")?this.disable():this.enable()},enable:function(){return this.nav.classList.add("nm-menu-open"),this.fireEvent("active"),this.displayDefaultView()},disable:function(){this.nav.classList.remove("nm-menu-open");for(var a=this.nav.querySelector("#nm-edit-content");a.firstChild;)a.removeChild(a.firstChild);return this.clear(),this.fireEvent("deactive"),this},save:function(){return this.fireEvent("save"),this},setAction:function(a,b){return networkMap.SettingsManager.isActionInterface(a,b),this._actions[a]=b,this},_runAction:function(a,b){if(void 0===this._actions[a]&&(this._action=networkMap.SettingsManager._actions[a]),null!==this._actions[a]&&void 0!==this._actions[a]&&(this._action=this._actions[a]),this._action){this.displayButtons(),this._action.addEvent("hideButtons",function(){this.hideButtons()}.bind(this)),this._action.addEvent("deletable",function(a){return a?this.btnDelete.classList.remove("nm-hidden"):this.btnDelete.classList.add("nm-hidden")}.bind(this)),this._action.addEvent("cancel",this.previousEdit.bind(this)),this._action.addEvent("addLink",function(a){this.mediator.publish("addLink",[a]),this.previousEdit()}.bind(this));var c=this._action.render(b);return c&&(this.clear(),this.getContentContainer().appendChild(c),this.editing.push(this._action)),c}},add:function(){return this._runAction("add")},addNode:function(){return this._runAction("addNode")},addLink:function(){return this._runAction("addLink")},configure:function(a){return this._runAction("configure",a)},"delete":function(a){return this._runAction("delete",this.editing[this.editing.length-1].configurationEvent())},modify:function(a){return this._runAction("modify",a)}}),networkMap.SettingsManager._actions={},networkMap.SettingsManager.registerAction=function(a,b){return networkMap.SettingsManager.isActionInterface(a,b),networkMap.SettingsManager._actions[a]=b,!0},networkMap.SettingsManager.isActionInterface=function(a,b){if(!networkMap.find(["add","delete","addNode","addLink","configure"],function(b){return b===a}))throw"Action not implemented: "+a;if(!b.render||!networkMap.isFunction(b.render))throw"Class does not implement actionInterface.render for "+a;if(!b.purge||!networkMap.isFunction(b.purge))throw"Class does not implement actionInterface.purge for "+a;return!0},networkMap.renderer=networkMap.renderer||{},networkMap.renderer.settingsManager=networkMap.renderer.settingsManager||{},networkMap.renderer.settingsManager.Add=function(){},networkMap.extend(networkMap.renderer.settingsManager.Add,networkMap.Observable),networkMap.extend(networkMap.renderer.settingsManager.Add,{render:function(){},purge:function(){},toElement:function(){}}),networkMap.SettingsManager.registerAction("add",new networkMap.renderer.settingsManager.Add),networkMap.renderer=networkMap.renderer||{},networkMap.renderer.settingsManager=networkMap.renderer.settingsManager||{},networkMap.renderer.settingsManager.AddLink=function(){
this.el=null,this.state=this.states.notRendered},networkMap.extend(networkMap.renderer.settingsManager.AddLink,networkMap.Observable),networkMap.extend(networkMap.renderer.settingsManager.AddLink,{render:function(){this.state.render.call(this)},purge:function(){this.state.purge.call(this)},states:{rendered:{render:function(){return this.el},purge:function(){this.state=this.states.notRendered}},notRendered:{render:function(){this.state=this.states.rendered},purge:function(){return!0}}}}),networkMap.SettingsManager.registerAction("addLink",new networkMap.renderer.settingsManager.AddLink),networkMap.renderer=networkMap.renderer||{},networkMap.renderer.settingsManager=networkMap.renderer.settingsManager||{},networkMap.renderer.settingsManager.Delete=function(){this.el=null,this.state=this.states.notRendered},networkMap.extend(networkMap.renderer.settingsManager.Delete,networkMap.Observable),networkMap.extend(networkMap.renderer.settingsManager.Delete,{render:function(a){this.state.render.call(this,a)},purge:function(){this.state.purge.call(this)},states:{rendered:{render:function(){return this.el},purge:function(){this.state=this.states.notRendered}},notRendered:{render:function(a){return a.deletable&&window.confirm("Are you sure you want to delete the "+a.type+" "+a.targetName)&&a.destroy(),null},purge:function(){return!0}}}}),networkMap.SettingsManager.registerAction("delete",new networkMap.renderer.settingsManager.Delete),networkMap.renderer=networkMap.renderer||{},networkMap.renderer.settingsManager.Configure=function(){this.el=null,this.e=null,this.state=this.states.notRendered},networkMap.extend(networkMap.renderer.settingsManager.Configure,networkMap.Observable),networkMap.extend(networkMap.renderer.settingsManager.Configure,{render:function(a){return this.state.render.call(this,a)},purge:function(){return this.state.purge.call(this)},configurationEvent:function(){return this.e},states:{rendered:{render:function(a){return this.el},purge:function(){this.el=null,this.state=this.states.notRendered}},notRendered:{render:function(a){return this.e=a,a.deletable?this.fireEvent("deletable",[!0]):this.fireEvent("deletable",[!1]),a.configWidget.toElement?(this.el=document.createElement("div"),this.el.appendChild(a.configWidget.toElement()),this.state=this.states.rendered,this.el):null},purge:function(){return!0}}}}),networkMap.SettingsManager.registerAction("configure",new networkMap.renderer.settingsManager.Configure),networkMap.renderer.link=networkMap.renderer.Link||{},networkMap.renderer.link.UtilizationLabel=function(a,b){this.label=null,this.rect=null,this.svg=a,this.value=null,b=b||{},this.cx=b.cx||null,this.cy=b.cy||null,delete b.cx,delete b.cy,this.options={enabled:!1,padding:2,fontSize:8,digits:0},this.setOptions(b),this.state=this.states.notRendered},networkMap.extend(networkMap.renderer.link.UtilizationLabel,networkMap.Options),networkMap.extend(networkMap.renderer.link.UtilizationLabel,networkMap.Observable),networkMap.extend(networkMap.renderer.link.UtilizationLabel,{NULL_STRING:"  -  ",setPosition:function(a,b){return this.cx=a,this.cy=b,this},render:function(a){return this.state.render.call(this,a)},hide:function(){return this.state.hide.call(this)},show:function(){return this.state.show.call(this)},purge:function(){return this.state.purge.call(this)},states:{notRendered:{render:function(a){if(!this.svg)return this;if(!this.options.enabled)return this;a=a||this.value;var b="#ffffff",c="#000000",d=1,e=this.svg,f=this.label=e.text(this.NULL_STRING).font({family:this.options.fontFamily,size:this.options.fontSize,anchor:"start",leading:this.options.fontSize}).move(parseFloat(this.options.padding),parseFloat(this.options.padding)),g=f.bbox();this.rect=e.rect(1,1).fill({color:b}).stroke({color:c,width:d}).attr({rx:2,ry:2}).size(g.width+2*this.options.padding,g.height+2*this.options.padding);return f.front(),this.state=this.states.rendered,this.render(a),this},hide:function(){return this},show:function(){return this},purge:function(){return this}},rendered:{render:function(a){if(a=this.value=a||this.value,a=null===a?null:100*a,!this.options.enabled||null===this.cx||null===this.cy)return this.hide(),this;this.show(),null===a?this.label.text(this.NULL_STRING):this.label.text((10>a?" ":"")+a.toFixed(this.options.digits)+"%"),this.label.font({family:this.options.fontFamily,size:this.options.fontSize,leading:this.options.fontSize}).move(parseFloat(this.options.padding),parseFloat(this.options.padding));var b=this.label.bbox();return this.rect.size(b.width+2*this.options.padding,b.height+2*this.options.padding),this.svg.center(parseFloat(this.cx),parseFloat(this.cy)),this.svg.front(),this},hide:function(){return this.svg.hide(),this.state=this.states.hidden,this},show:function(){return this},purge:function(a){}},hidden:{render:function(a){return this.options.enabled?this.show():(this.value=a,this)},hide:function(){return this},show:function(){return this.svg.show(),this.state=this.states.rendered,this.render()},purge:function(a){}}}}),networkMap.Graph=function(a,b){var c={width:10,height:10,datasource:void 0,colormap:void 0,enableEditor:!0,allowDraggableNodes:void 0,refreshInterval:300,batchUpdate:!0,gridEnabled:!0,grid:{x:10,y:10},utilizationLabels:{enabled:!1,fontSize:8,padding:2}};this.defaults={},this.exportedOptions=[],this.nodes=[],this.links=[],this.saveData={},this._mode="normal",this.node=this.node||{},b=b||{},b.node&&b.node.linkGenerator?(this.node.linkGenerator=networkMap.Node.createLinkGenerator(this.options.node.linkGenerator),delete b.node):this.node.linkGenerator=networkMap.Node._linkGenerator,this.link=this.link||{},b.link&&b.link.linkGenerator?(this.link.linkGenerator=networkMap.Link.createLinkGenerator(this.options.link.linkGenerator),delete b.link):this.link.linkGenerator=networkMap.Link._linkGenerator,this.properties=new networkMap.Properties(b,new networkMap.Properties(c)),this.properties.addEvent("change",function(a){var b=!1,c=this;a.forEach(function(a){"gridEnabled"===a.key&&(b=!0),"grid"===a.key&&(b=!0),"utilizationLabels"===a.key&&c.onUtilizationLabelsChange()}),b&&this.onGridChange(),c=null}.bind(this)),this.defaults.node=new networkMap.Properties({},networkMap.Node.defaults),this.defaults.link=new networkMap.Properties({},networkMap.Link.defaults),this.defaults.link.set("colormap",this.properties.get("colormap")),this.defaults.link.set("datasource",this.properties.get("datasource")),this.element="string"==typeof a||a instanceof String?document.getElementById(a):a,this.container=document.createElement("div"),this.container.classList.add("nm-container"),this.element.appendChild(this.container),this.svg=SVG(this.container),this.graph=this.svg.group(),this.legend=new networkMap.ColorLegend(this.defaults.link.get("colormap"),{graph:this,target:this.container}),this.properties.get("enableEditor")&&(this.settings=new networkMap.SettingsManager(this.container,this,new networkMap.event.Configuration({deletable:!1,editable:!0,editWidget:new networkMap.Graph.Module.Settings(this.defaults.node,this.defaults.link,this.properties).toElement(),target:this,type:"graph",targetName:"graph"})),this.settings.addEvent("active",this.enableEditor.bind(this)),this.settings.addEvent("deactive",this.disableEditor.bind(this)),this.settings.addEvent("save",this.save.bind(this))),this.subscribe("addLink",this.addLinkBySubsriber.bind(this)),this.addEvent("resize",this.rescale.bind(this)),this.setRefreshInterval(this.properties.get("refreshInterval")),this.svg.on("click",this._clickHandler.bind(this)),this.addEvent("load",this.update.bind(this))},networkMap.extend(networkMap.Graph,networkMap.Observable),networkMap.extend(networkMap.Graph,networkMap.Mediator),networkMap.extend(networkMap.Graph,networkMap.Options),networkMap.extend(networkMap.Graph,{setDefaults:function(a,b){if(!this.defaults[a])throw"Illigal element";return this.defaults[a].set(b),this.fireEvent("redraw",[{defaultsUpdated:!0}]),this},getDefaults:function(a){if(!this.defaults[a])throw"Illigal element";return this.defaults[a]},setRefreshInterval:function(a){return this.properties.set("refreshInterval",a),a?this.intervalId=setInterval(function(){this.update()}.bind(this),1e3*a):this.intervalId&&(clearInterval(this.intervalId),delete this.intervalId),this},triggerEvent:function(a,b){return b.fireEvent(a,b),this},rescale:function(){var a={x:this.element.offsetWidth,y:this.element.offsetHeight};this.svg.size(a.x,a.y);var b=this.graph.bbox();if(a.x>Math.abs(b.x)+b.width&&a.y>Math.abs(b.y)+b.height)this.svg.viewbox(b.x<0?b.x:0,b.y<0?b.y:0,a.x,a.y);else if(a.x>b.width&&a.y>b.height)this.svg.viewbox(b.x-(a.x-b.width)/2,b.y-(a.y-b.height)/2,a.x,a.y);else{var c=b.width-a.x>b.height-a.y?b.width/a.x:b.height/a.y;this.svg.viewbox(b.x-5,b.y-5,a.x*c+10,a.y*c+10)}return this},getSVG:function(){return this.svg},getPaintArea:function(){return this.graph},settingsManager:function(){return this.settings()},getSettingsWidget:function(){var a,b=new networkMap.widget.Accordion,c=function(a,b){return function(c,d){a.set(b,d.value())}.bind(this)}.bind(this);return a=b.add("Globals"),a.appendChild(new networkMap.widget.GridInput("Grid",{enabled:this.options.gridEnabled,grid:this.options.grid}).addEvent("change",function(a){a.value.enabled?this.grid(a.value.grid):this.grid(!1)}.bind(this))),a=b.add("Node Defaults"),networkMap.each(networkMap.Node.defaultTemplate,function(b,d){"number"===b.type?a.appendChild(new networkMap.widget.IntegerInput(b.label,this.defaults.node.get(d,!0),b).addEvent("change",c(this.defaults.node,d))):"text"===b.type?a.appendChild(new networkMap.widget.TextInput(b.label,this.defaults.node.get(d,!0),b).addEvent("change",c(this.defaults.node,d))):"color"===b.type&&a.appendChild(new networkMap.widget.ColorInput(b.label,this.defaults.node.get(d,!0),b).addEvent("change",c(this.defaults.node,d)))}.bind(this)),a=b.add("Link Defaults"),networkMap.each(networkMap.Link.defaultTemplate,function(b,d){"number"===b.type?a.appendChild(new networkMap.widget.IntegerInput(b.label,this.defaults.link.get(d,!0),b).addEvent("change",c(this.defaults.link,d))):"text"===b.type?a.appendChild(new networkMap.widget.TextInput(b.label,this.defaults.link.get(d,!0),b).addEvent("change",c(this.defaults.link,d))):"color"===b.type&&a.appendChild(new networkMap.widget.ColorInput(b.label,this.defaults.link.get(d,!0),b).addEvent("change",c(this.defaults.link,d)))}.bind(this)),b},grid:function(a){return a===!0?(this.properties.set("gridEnabled",!0),this):(a===!1&&this.properties.set("gridEnabled",!1),void 0===a?this.properties.get("gridEnabled")?this.properties.get("grid"):!1:("object"==typeof a&&(this.properties.set("gridEnabled",!0),this.properties.set("grid",a)),this.onGridChange()))},onGridChange:function(){return this.disableDraggableNodes(),this.enableDraggableNodes(),this},onUtilizationLabelsChange:function(){var a=this.properties.get("utilizationLabels");this.links.forEach(function(b){b.setUtilizationLabelOptions(a)}),a=null},load:function(a){if("string"==typeof a||a instanceof String)return this.loadUrl(a);if(null!==a&&"object"==typeof a)return this.loadObject(a);throw new TypeError("Unknown type "+Object.prototype.toString.call(a))},loadUrl:function(a){var b=new XMLHttpRequest;return b.open("GET",a,!0),b.onload=function(){b.status>=200&&b.status<400?this.loadObject(JSON.parse(b.responseText)):(new networkMap.widget.Modal).alert("There was an error when loading the weathermap ("+b.status+")",{title:"Error"})}.bind(this),b.onerror=function(){(new networkMap.widget.Modal).alert("An error occurred when trying to load the resource",{title:"Error"})},b.send(),this},loadObject:function(a){return this.setOnSave(a.onSave),a.nodes=a.nodes||[],a.links=a.links||[],a.defaults&&(a.defaults.graph&&a.defaults.graph.utilizationLabels&&("false"===a.defaults.graph.utilizationLabels.enabled&&(a.defaults.graph.utilizationLabels.enabled=!1),"true"===a.defaults.graph.utilizationLabels.enabled&&(a.defaults.graph.utilizationLabels.enabled=!0)),this.properties.set(a.defaults.graph||{}),this.setDefaults("node",a.defaults.node||{}),this.setDefaults("link",a.defaults.link||{})),a.nodes.forEach(function(a){a.graph=this,a.draggable=this.properties.get("allowDraggableNodes"),this.addNode(new networkMap.Node(a),!1)}.bind(this)),a.links.forEach(function(a){a.graph=this,this.addLink(new networkMap.Link(a),!1)}.bind(this)),this.settings.setConfigWidget(new networkMap.Graph.Module.Settings(this.defaults.node,this.defaults.link,this.properties).toElement()),this.fireEvent("load",[this]),this.triggerEvent("resize",this),this.onUtilizationLabelsChange(),this},setOnSave:function(a){return a&&this.validateSave(a)&&(this.saveData=a),this},getOnSave:function(){return this.saveData?this.saveData:{}},validateSave:function(a){return a.method&&"post"!=a.method&&"get"!=a.method?(this.saveEnabled=!1,alert("Illigal argument: "+a.method+". Valid onSave.method arguments are: post, get"),!1):(a.method="post",a.data=a.data||{},a.url?!0:(this.saveEnabled=!1,alert("Missing argument onSave.url"),!1))},save:function(){if(!this.saveData)return!1;var a=this.getConfiguration(),b=this.settings.btnSave.innerHTML;this.settings.btnSave.textContent=".....";var c=new XMLHttpRequest;return c.open(this.saveData.method,this.saveData.url,!0),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.onload=function(){this.settings.btnSave.innerHTML=b,c.status>=200&&c.status<400?(a=JSON.parse(c.responseText),"ok"===a.status&&(new networkMap.widget.Modal).alert("Weathermap saved"),"nok"===a.status&&(new networkMap.widget.Modal).alert(a.error,{title:"Error"}),"deleted"==a.status&&(new networkMap.widget.Modal).alert("The networkmap is deleted",{title:"Error"})):(new networkMap.widget.Modal).alert("There was an error while saving the weathermap ("+c.status+")",{title:"Error"})}.bind(this),c.onerror=function(){this.settings.btnSave.innerHTML=b,(new networkMap.widget.Modal).alert("There was an error while saving the weathermap",{title:"Error"})},c.send(JSON.stringify(a)),!0},mode:function(){return this._mode},enableEditor:function(){return this.enableDraggableNodes(),this.nodes.forEach(function(a){a.mode("edit")}),this.links.forEach(function(a){a.mode("edit")}),this._mode="edit",this},disableEditor:function(){return this.disableDraggableNodes(),this.nodes.forEach(function(a){a.mode("normal")}),this.links.forEach(function(a){a.mode("normal")}),this._mode="normal",this},_clickHandler:function(a){"edit"===this._mode&&(a.target.instance===this.svg||a.target.instance===this.graph)&&this.settings.displayDefaultView()},enableDraggableNodes:function(){return this.nodes.forEach(function(a){a.draggable()}),this},disableDraggableNodes:function(){return this.nodes.forEach(function(a){a.fixed()}),this},getConfiguration:function(){var a={defaults:{graph:this.properties.extract(),node:this.defaults.node.extract(),link:this.defaults.link.extract()},nodes:[],links:[],onSave:this.saveData};return this.exportedOptions.forEach(function(b){a[b]=this.options[b]}.bind(this)),a.onSave=this.saveData,this.nodes.forEach(function(b){a.nodes.push(b.getConfiguration())}),this.links.forEach(function(b){a.links.push(b.getConfiguration())}),a},registerLinkGenerator:function(a,b){this._linkGenerator[a]=b},addNode:function(a,b){return this.nodes.push(a),a.addEvent("requestHref",this.node.linkGenerator),a.updateLink(),b!==!1&&this.triggerEvent("resize",this),this},getNode:function(a){return networkMap.find(this.nodes,function(b){return b.options.id===a?!0:void 0})},removeNode:function(a){return this.nodes.erase(a),a.setGraph(null),this.getLinks(a).forEach(function(a){this.removeLink(a)}.bind(this)),this},addLink:function(a,b){return this.links.push(a),a.addEvent("requestHref",this.link.linkGenerator),a.updateHyperlinks(),b!==!1&&this.triggerEvent("resize",this),this},addLinkBySubsriber:function(a){var b=this;if(a.nodes&&a.nodes.each(function(a){if(!b.getNode(a.id)){a.graph=a.graph||b;var c=new networkMap.Node(a);b.addNode(c),"edit"===b.mode()&&c.draggable().mode("edit")}}),!this.getLink(a.link.nodeA.id,a.link.nodeB.id)){a.link.graph=a.link.graph||this;var c=new networkMap.Link(a.link);this.addLink(c),c.update(!0),"edit"===this.mode()&&c.mode("edit")}return this},getLink:function(a,b){return networkMap.find(this.links,function(c){return c.nodeA.options.id===a&&c.nodeB.options.id===b?!0:c.nodeA.options.id===b&&c.nodeB.options.id===a?!0:void 0})},getLinks:function(a,b){var c=[];return this.links.forEach(function(d){d.connectedTo(a,b)&&c.push(d)}),c},removeLink:function(a){return this.links.erase(a),a.setGraph(null),this},refresh:function(){return console.log("refresh is depricated, use update instead"),this.update()},registerUpdateEvent:function(a,b,c,d){this.$updateQ=this.$updateQ||{},this.$updateQ[a]=this.$updateQ[a]||{},this.$updateQ[a][b]=this.$updateQ[a][b]||[],this.$updateQ[a][b].push({link:c,callback:d})},update:function(){return this.properties.get("batchUpdate")?this.batchUpdate():(this.links.forEach(function(a){a.localUpdate()}),this)},batchUpdate:function(){return this.$updateQ=this.$updateQ||{},networkMap.each(this.$updateQ,function(a,b){if(!networkMap.datasource[b])throw"Unknown datasource ("+b+")";networkMap.each(a,function(a,c){networkMap.datasource[b](c,a)}.bind(this))}.bind(this)),this}}),networkMap.Graph.Module=networkMap.Graph.Module||{},networkMap.Graph.Module.Settings=function(a,b,c){this.nodeProperties=a,this.linkProperties=b,this.graphProperties=c},networkMap.extend(networkMap.Graph.Module.Settings,{toElement:function(a,b,c){a=a||this.nodeProperties,b=b||this.linkProperties,c=c||this.graphProperties;var d,e=new networkMap.widget.Accordion,f=new networkMap.Node.Module.Settings(a,{onlyGlobals:!0,header:"Node Defaults",container:e}),g=new networkMap.Link.Module.Settings(b,{onlyGlobals:!0,header:"Link Defaults",container:e});(function(a,b){return function(c,d){a.set(b,d.value())}.bind(this)}).bind(this);d=e.add("Globals"),d.appendChild(new networkMap.widget.GridInput("Grid",{enabled:c.get("gridEnabled"),grid:c.get("grid")}).addEvent("change",function(a){c.set({grid:a.value.grid,gridEnabled:a.value.enabled})}.bind(this))),d=e.add("Utilization Labels");var h=c.get("utilizationLabels");return d.appendChild(new networkMap.widget.Checkbox("Enabled",h.enabled).addEvent("change",function(a){h.enabled=a.value,c.set("utilizationLabels",h)}.bind(this))),d.appendChild(new networkMap.widget.IntegerInput("Padding",h.padding).addEvent("change",function(a){h.padding=a.value,c.set("utilizationLabels",h)}.bind(this))),d.appendChild(new networkMap.widget.IntegerInput("Font size",h.fontSize).addEvent("change",function(a){h.fontSize=a.value,c.set("utilizationLabels",h)}.bind(this))),f.toElement(),g.toElement(),this.el=e,e}}),networkMap.Node=function(a){if(this.graph=a.graph,delete a.graph,this.properties=new networkMap.Properties(a,networkMap.Node.defaults),this.configurationWidget=new networkMap.Node.Module.Settings,this.properties.addEvent("change",function(a){this.options=this.properties.configuration(),a.length>=1&&("x"===a[0].key||"y"===a[0].key)||this.draw()}.bind(this)),this.options=this.properties.configuration(),!this.options.id)throw"Node(create, no id given)";this.options.x=parseFloat(this.options.x),this.options.y=parseFloat(this.options.y),this.options.padding=parseFloat(this.options.padding),this.setGraph(this.graph)},networkMap.extend(networkMap.Node,networkMap.Options),networkMap.extend(networkMap.Node,networkMap.Observable),networkMap.extend(networkMap.Node,{_mode:"normal",exportedOptions:["id","name","comment","x","y","lat","lng","weight","renderer","information","label","padding","href","style","events","fontFamily","fontSize","bgColor","strokeColor","strokeWidth","drawingCallback"],setProperty:function(a,b){if(!this.editTemplate[a])throw"Unknow id: "+a;return this.properties.set(a,b),this.options=this.properties.configuration(),this},getProperty:function(a){return this.properties.get(a,!0).value},getConfiguration:function(){return this.properties.extract()},enableEvent:function(a,b){if("hover"!==a&&"click"!==a)throw"Unknown event";this.options.events=this.options.events||{},this._localConfig.events=this._localConfig.events||{};var c={enabled:!0};return this.options.events[a]=b||c,this._localConfig.events[a]=b||c,this},disableEvent:function(a,b){return this.options.events&&this.options.events[a]&&(delete this.options.events[a],delete this._localConfig.events[a]),this},setGraph:function(a){return this.graph&&(this.graph.removeEvent("redraw",this._redraw.bind(this)),this.graph=null,this.draw()),a&&(this.graph=a,this.properties.setDefaults(a.getDefaults("node")),this.options=this.properties.configuration(),this.graph.addEvent("redraw",this._redraw.bind(this)),this.draw()),this},_redraw:function(){this.draw()},mode:function(a){if(!a)return this._mode;if("edit"!==a&&"normal"!==a)throw"Unknown mode: "+a;return this._mode=a,this},_clickhandler:function(a){if(a.target.instance.data("dragged"))return void a.preventDefault();if("normal"===this._mode&&this.options.events&&this.options.events.click)networkMap.events.click(a,this);else if("edit"===this._mode){if(a.preventDefault(),this.svg.dragged)return;this.graph.publish("edit",[new networkMap.event.Configuration({deletable:!0,destroy:function(){this.graph.removeNode(this)}.bind(this),editable:!0,editWidget:this.configurationWidget.toElement(this.properties),target:this,type:"node",targetName:this.properties.get("name")})])}},x:function(){return this.svg.bbox().x},y:function(){return this.svg.bbox().y},draggable:function(){this._draggable=!0;var a=this.graph.grid();return this.svg.draggable(function(b,c,d){return a?{x:b-b%a.x,y:c-c%a.y}:!0}),this.svg.remember("cursor",this.svg.style("cursor")),this.svg.style("cursor","move"),this},fixed:function(){this._draggable=!1,this.svg.draggable(!1);var a=this.svg.remember("cursor");return this.svg.forget("cursor"),this.svg.style("cursor",a||"default"),this},isDraggable:function(){return this._draggable},updateLink:function(){var a=this.options.href;return a?(networkMap.isFunction(a)?this.setLink(a(this)):this.setLink(a),this):(this.fireEvent("requestHref",[this]),this)},setLink:function(a){return a?this.link?(this.link.to(a),this):(this.link=this.svg.linkTo(a).parent,this):this},bbox:function(){return this.svg.tbox()},draw:function(){var a=!1;if(this.svg){if(this.svg.remove(),this.link&&this.link.remove(),!this.graph)return!1;a=!0}if(!this.graph)return!1;this.debug&&this.debug.remove(),this.options.debug&&(this.debug=this.graph.getPaintArea().group());var b=this.svg=this.graph.getPaintArea().group();if(this.updateLink(),this.options.drawingCallback&&this.options.drawingCallback in networkMap.drawingCallbacks)networkMap.drawingCallbacks[this.options.drawingCallback](this,b);else{var c,d=b.text(this.options.name).font({family:this.options.fontFamily,size:this.options.fontSize,anchor:"start"}).move(parseFloat(this.options.padding),parseFloat(this.options.padding)),e=d.bbox();for(this.options.comment&&""!==this.options.comment&&(d.text(function(a){a.tspan(this.options.name).newLine(),c=a.tspan(this.options.comment).newLine().attr("font-size",this.options.fontSize-2)}.bind(this)),c.attr("text-anchor","middle"),c.dx(e.width/2));e.width<d.bbox().width;)c.attr("font-size",c.attr("font-size")-1);e=d.bbox();var f=b.rect(1,1).fill({color:this.options.bgColor}).stroke({color:this.options.strokeColor,width:this.options.strokeWidth}).attr({rx:4,ry:4}).size(e.width+2*this.options.padding,e.height+2*this.options.padding);d.front();f.clone().fill({opacity:0}).front();b.move(parseFloat(this.options.x),parseFloat(this.options.y))}return b.on("click",this._clickhandler.bind(this)),this.options.events&&(b.link=this.options.events,this.options.events.click&&b.attr("cursor","pointer")),this.options.draggable&&this.draggable(),b.on("dragstart",function(a){this.fireEvent("dragstart")}.bind(this)),b.on("dragmove",function(a){this.fireEvent("drag",a)}.bind(this)),b.on("dragend",function(a){this.properties.set({x:this.x(),y:this.y()}),this.fireEvent("dragend")}.bind(this)),this.isDraggable()&&this.draggable(),this.fireEvent("dragend"),!0}}),networkMap.Node.defaultTemplate={padding:{label:"Padding",type:"number",min:0},fontSize:{label:"Font size",type:"number",min:1},bgColor:{label:"Color",type:"color"},strokeColor:{label:"Stroke color",type:"color"},strokeWidth:{label:"Stroke width",type:"number",min:0}},networkMap.Node.registerLinkGenerator=function(a){networkMap.Node._linkGenerator=networkMap.Node.createLinkGenerator(a)},networkMap.Node.createLinkGenerator=function(a){return function(b){var c=b.properties.get("href");return c?void(networkMap.isFunction(c)?b.setLink(c()):b.setLink(c)):void b.setLink(a(b))}},networkMap.Node.registerLinkGenerator(function(a){return null}),networkMap.Node.defaults=new networkMap.Properties({name:null,comment:null,x:10,y:10,lat:null,lng:null,weight:null,fontFamily:"Helvetica",fontSize:16,bgColor:"#dddddd",strokeColor:"#000000",strokeWidth:2,information:{},data:{value:null,realValue:null},label:{position:"internal",visable:!0},renderer:"rect",padding:10,href:null,style:null,debug:!1,draggable:!1,drawingCallback:null}),networkMap.Node.Module=networkMap.Node.Module||{},networkMap.Node.Module.Settings=function(a,b){this.options={onlyGlobals:!1,header:"Globals",container:null},this.setOptions(b),this.properties=a},networkMap.extend(networkMap.Node.Module.Settings,networkMap.Options),networkMap.extend(networkMap.Node.Module.Settings,{parameters:{id:{label:"ID",type:"text",disabled:!0,global:!1},name:{label:"Name",type:"text",global:!1},comment:{label:"Comment",type:"text",global:!1},padding:{label:"Padding",type:"number",min:0,global:!0},fontSize:{label:"Font size",type:"number",min:1,global:!0},bgColor:{label:"Color",type:"color",global:!0},strokeColor:{label:"Stroke color",type:"color",global:!0},strokeWidth:{label:"Stroke width",type:"number",min:0,global:!0}},toElement:function(a){a=a||this.properties;var b,c=this.options.container||new networkMap.widget.Accordion,d=function(a,b){return function(c,d){b.set(a,d.value())}};return b=c.add(this.options.header),networkMap.each(this.parameters,function(c,e){(!this.options.onlyGlobals||c.global)&&("number"===c.type?b.appendChild(new networkMap.widget.IntegerInput(c.label,a.get(e),c).addEvent("change",d(e,a))):"text"===c.type?b.appendChild(new networkMap.widget.TextInput(c.label,a.get(e),c).addEvent("change",d(e,a))):"color"===c.type&&b.appendChild(new networkMap.widget.ColorInput(c.label,a.get(e),c).addEvent("change",d(e,a))))}.bind(this)),c}}),networkMap.Node.registerEvent=function(a,b){if("hover"===a)return this.registerHover(b);if(!networkMap._events[a])throw"Invalid event: "+a;networkMap._events[a]=b},networkMap.Node.registerEvent.registerHover=function(a){var b=function(b,c,d){var e=document.id("nm-active-hover");b.target.instance.attr("id");if(e){if(e.retrieve("id")===b.target.instance.attr("id"))return void e.store("keep",!0);e.destroy()}e=new Element("div",{id:"nm-active-hover","class":"nm-hover",events:{mouseover:function(){e.store("mouseover",!0)},mouseout:function(){e.eliminate("mouseover"),function(){e.retrieve("keep")?e.eliminate("keep"):e.destroy()}.delay(10)},click:function(a){node._clickHandler(b)}}}).store("id",b.target.instance.attr("id")),e.setStyles({top:-1e3,left:-1e3}),document.id(document.body).grab(e),a(b,node,e);var f=e.getSize(),g=b.target.getBoundingClientRect();e.setStyles({top:(g.top+g.bottom)/2-f.y/2,left:(g.left+g.right)/2-f.x/2})},c=function(a,b){a.target.instance.node;(function(){var b=document.id("nm-active-hover");b&&b.retrieve("id")!==a.target.instance.attr("id")||b&&!b.retrieve("mouseover")&&b.destroy()}).delay(10)};networkMap.Node.registerEvent("mouseover",b),networkMap.Node.registerEvent("mouseout",c)},networkMap.Node._events={click:function(a,b){},mouseover:function(a,b,c){},mouseout:function(a,b){},hover:function(a,b,c){c.set("text",b.options.name)}},networkMap.LinkPath=function(a,b,c){this.properties=new networkMap.Properties(c,a.properties),this.properties.addEvent("change",function(a){this.fireEvent("change",a)}.bind(this)),this.subLink=a,this.mediator=this.getLink().graph,this.svg=b,this.value=null,b.hide(),this.setupEvents()},networkMap.extend(networkMap.LinkPath,networkMap.Options),networkMap.extend(networkMap.LinkPath,networkMap.Observable),networkMap.extend(networkMap.LinkPath,{purge:function(){return this},hide:function(){return this.svg.hide(),this},show:function(){return this.svg.show(),this},remove:function(){this.svg.remove()},getEditables:function(){var a={width:{label:"Local width",type:"int"}};return a},updateHyperlink:function(){var a=this.properties.get("href");return a?(networkMap.isFunction(a)?this.setLink(a(this)):this.setLink(a),this):(this.fireEvent("requestHref",[this]),this)},updateBgColor:function(a){return a?(this.svg.fill(a),this):(this.svg.fill(this.options.background),this)},setLink:function(a){return a?this.a?(this.a.to(a),this):(this.svg.parent&&(this.a=this.svg.linkTo(a)),this):this},isDrawable:function(){return void 0!==this.properties.get("requestData")&&void 0!==this.properties.get("requestUrl")},getCenter:function(){var a=this.svg.bbox();return{cx:a.x+a.height/2,cy:a.y+a.width/2}},getSubLink:function(){return this.subLink},getLink:function(){return this.getSubLink().getLink()},getNode:function(){return this.getSubLink().getNode()},getSibling:function(){return void 0},getSettingsWidget:function(){return this.getLink().getSettingsWidget()},getUtilization:function(){return this.value},getProperty:function(a){return this.properties.get(a)},setProperty:function(a,b){if("width"==a){var c=this.getMainPath();if(c!=this)return c.setProperty(a,b)}return this.properties.set(a,b),this.fireEvent("change",[a]),this},getConfiguration:function(){return this.properties.extract()},getMainPath:function(){var a;return this.link.subpath.nodeA&&(this.link.subpath.nodeA.forEach(function(b){this==b&&(a=this.link.path.nodeA)}.bind(this)),a)?a:this.link.subpath.nodeB&&(this.link.subpath.nodeB.forEach(function(b){this==b&&(a=this.link.path.nodeB)}.bind(this)),a)?a:this},setupEvents:function(){this.svg.on("click",this._clickHandler.bind(this)),this.properties.get("events")&&(this.properties.get("events.click")&&this.svg.attr("cursor","pointer"),this.properties.get("events.hover")&&(this.svg.on("mouseover",this._hoverHandler.bind(this)),this.svg.on("mouseout",this._hoverHandler.bind(this)))),this.properties.get("requestUrl")&&this.getLink().registerUpdateEvent(this.getLink().properties.get("datasource"),this.properties.get("requestUrl"),this,function(a){this.value=a.value,this.updateBgColor(this.getLink().colormap.translate(a.value)),this.getSubLink().setUtilizationLabel()}.bind(this))},_clickHandler:function(a){"normal"===this.getLink().mode()&&this.properties.get("events.click")?networkMap.events.click(a,this):"edit"===this.getLink().mode()&&(a.preventDefault(),this.getLink().drawEdgeHandles(),this.mediator.publish("edit",[new networkMap.event.Configuration({deletable:!0,destroy:function(){this.getLink().graph.removeLink(this.getLink())}.bind(this),cancel:function(){this.getLink().hideEdgeHandles()}.bind(this),editable:!0,editWidget:this.getLink().configurationWidget.toElement(this.getLink(),this.getLink().properties),target:this,type:"link",targetName:this.properties.get("name")})]))},_hoverHandler:function(a){"edit"!==this.getLink().mode()&&("mouseover"===a.type&&networkMap.events.mouseover(a,this),"mouseout"===a.type&&networkMap.events.mouseout(a,this))}}),networkMap.PrimaryLink=function(a,b,c){networkMap.LinkPath.call(this,a,b,c)},networkMap.PrimaryLink.prototype=Object.create(networkMap.LinkPath.prototype),networkMap.PrimaryLink.constructor=networkMap.PrimaryLink,networkMap.extend(networkMap.PrimaryLink,{getSibling:function(){return this.getSubLink().getSibling(this)},draw:function(a,b,c,d){if(!this.isDrawable())return this;if(0===d)return this.drawFullPath(a,b,c,d);if(d>0)return this.drawShortPath(a,b,c,d);throw"Invalid member link count"},drawFullPath:function(a,b,c,d){
this.svg.show(),d=d||1;var e=new SVG.math.Line(a[0],a[2]),f=new SVG.math.Line(a[2],a[3]),g=e.perpendicularLine(a[1],d*b),h=e.perpendicularLine(a[2],d*b),i=f.perpendicularLine(a[2],d*b),j=f.midPoint(),k=f.move(j,f.p1,c),l=(f.move(j,f.p2,c),f.perpendicularLine(k,d*b)),m=new SVG.math.Line(g.p1,h.p1),n=new SVG.math.Line(i.p1,l.p1),o=n.intersection(m);o.parallel===!0&&(o=g.p1),m=new SVG.math.Line(g.p2,h.p2),n=new SVG.math.Line(i.p2,l.p2);var p=n.intersection(m);return p.parallel===!0&&(p=g.p2),this.svg.clear(),this.svg.M(a[0]).L(g.p1).L(o).L(l.p1).L(j).L(l.p2).L(p).L(g.p2).Z().front(),this},drawShortPath:function(a,b,c,d){this.svg.show();var e=new SVG.math.Line(a[2],a[3]),f=e.midPoint(),g=e.move(f,e.p1,c),h=e.perpendicularLine(g,d*b/2),i=new SVG.math.Line(a[2],f).midPoint(),j=e.perpendicularLine(i,d*b/2);return this.svg.clear(),this.svg.M(i).L(j.p1).L(h.p1).L(f).L(h.p2).L(j.p2).Z().front(),this}}),networkMap.MemberLink=function(a,b,c){networkMap.LinkPath.call(this,a,b,c)},networkMap.MemberLink.prototype=Object.create(networkMap.LinkPath.prototype),networkMap.MemberLink.constructor=networkMap.MemberLink,networkMap.extend(networkMap.MemberLink,{getSibling:function(){return this.getSubLink().getSibling(this)},draw:function(a,b,c,d,e){return this.drawSublink(a,b,c,d,e)},drawSublink:function(a,b,c,d,e){this.svg.show();var f=SVG.math.angle(a[0],a[1])<Math.PI?1:-1,g=-d/2+e,h=[a[0],a[1],a[2],new SVG.math.Line(a[2],a[3]).midPoint()],i=this.calculateSublinkPath(h,b,c,d,f*g),j=this.calculateSublinkPath(h,b,c,d,f*(g+1)),k=a[0];return this.svg.clear(),g===-.5?this.svg.M(k).L(i[0]).L(i[1]).L(i[2]).L(h[h.length-1]).L(j[2]).L(j[1]).L(j[0]).Z().back():this.svg.M(k).L(i[0]).L(i[1]).L(i[2]).L(j[2]).L(j[1]).L(j[0]).Z().back(),this},calculateSublinkPath:function(a,b,c,d,e){var f=Math.atan2(c,Math.abs(b*d/2)),g=Math.abs(b*e*Math.tan(f)),h=new SVG.math.Line(a[0],a[2]),i=new SVG.math.Line(a[2],a[3]),j=h.perpendicularLine(a[1],b*e),k=h.perpendicularLine(a[2],b*e),l=i.perpendicularLine(a[2],b*e),m=i.move(i.p2,i.p1,g),n=i.perpendicularLine(m,b*e),o=new SVG.math.Line(j.p1,k.p1),p=new SVG.math.Line(l.p1,n.p1),q=p.intersection(o);return q.parallel===!0&&(q=j.p1),[j.round(2).p1,q.round(2),n.round(2).p1]}}),networkMap.SubLink=function(a,b,c,d,e){this.link=a,this.node=b,this.edge=c,this.svg=d,this.primaryLink=null,this.memberLinks=[],this.utilizationLabelsConfiguration=null,this.utilizationLabel=null,this.pathPoints=null,this.initializeUtilizationLabel()},networkMap.extend(networkMap.SubLink,networkMap.Options),networkMap.extend(networkMap.SubLink,networkMap.Observable),networkMap.extend(networkMap.SubLink,{purge:function(){this.link=null,this.node=null,this.svg=null,this.primaryLink.purge();for(var a=0,b=this.memberLinks.length;b>a;a++)this.memberLinks[a].purge();this.memberLinks.lenght=0,this.utilizationLabelsConfiguration=null,this.utilizationLabel=null,this.pathPoints=null},load:function(a){return a.sublinks&&this.loadMemberLinks(a.sublinks),this.loadPrimaryLink(a),this},loadPrimaryLink:function(a){return this.primaryLink=new networkMap.PrimaryLink(this,networkMap.path(this.svg),a).addEvent("change",function(){this.fireEvent("redraw")}.bind(this)).addEvent("requestHref",function(a){this.fireEvent("requestHref",[a])}.bind(this)),this},loadMemberLinks:function(a){for(var b=0,c=a.length;c>b;b++)this.loadMemberLink(a[b]);return this},loadMemberLink:function(a){return this.memberLinks.push(new networkMap.MemberLink(this,networkMap.path(this.svg),a).addEvent("change",this.redraw.bind(this)).addEvent("requestHref",function(a){this.fireEvent("requestHref",[a])}.bind(this))),this},getConfiguration:function(){var a=this.primaryLink.getConfiguration();a.sublinks=[];for(var b=0,c=this.memberLinks.length;c>b;b++)a.sublinks.push(this.memberLinks[b].getConfiguration());return 0===a.sublinks.length&&delete a.sublinks,a.edge=this.edge.getConfiguration(),a},draw:function(a,b){this.pathPoints=a,this.primaryLink.draw(a,b.get("width"),b.get("arrowHeadLength"),this.memberLinks.length);for(var c=0,d=this.memberLinks.length;d>c;c++)this.memberLinks[c].draw(a,b.get("width"),b.get("arrowHeadLength"),this.memberLinks.length,c);return this.setUtilizationLabelPosition(),this},redraw:function(){return this},setPath:function(a){return this.pathPoints=a,this},hide:function(){this.primaryLink.hide();for(var a=0,b=this.memberLinks.length;b>a;a++)this.memberLinks[a].hide();return this.utilizationLabel.hide(),this},show:function(){this.primaryLink.show();for(var a=0,b=this.memberLinks.length;b>a;a++)this.memberLinks[a].show();return this.utilizationLabel.show(),this},initializeUtilizationLabel:function(){return this.utilizationLabelConfiguration=networkMap.defaults(this.utilizationLabelsConfiguration,this.link.graph.properties.get("utilizationLabels")),this.utilizationLabel=new networkMap.renderer.link.UtilizationLabel(this.svg.group(),this.utilizationLabelsConfiguration),this},setUtilizationLabelPosition:function(){var a,b=new SVG.math.Line(this.pathPoints[2],this.pathPoints[3]).midPoint();return a=new SVG.math.Line(this.pathPoints[2],b).midPoint(),this.utilizationLabel.setPosition(a.x,a.y).render(),a=null,b=null,this},setUtilizationLabelOptions:function(a){return a=a||{},this.utilizationLabelConfiguration.enabled=void 0===a.enabled?this.utilizationLabelConfiguration.enabled:a.enabled,this.utilizationLabelConfiguration.fontSize=a.fontSize||this.utilizationLabelConfiguration.fontSize,this.utilizationLabelConfiguration.padding=a.padding||this.utilizationLabelConfiguration.padding,this.utilizationLabel.setOptions(this.utilizationLabelConfiguration),this.setUtilizationLabel(),this},setUtilizationLabel:function(a){return void 0===a&&(a=this.getUtilization()),this.utilizationLabel.render(a),this},hideUtilizationLabel:function(){return this.utilizationLabel.hide(),this},showUtilizationLabel:function(){return this.utilizationLabel.show(),this},updateHyperlinks:function(){for(var a=0,b=this.memberLinks.length;b>a;a++)this.memberLinks[a].updateHyperlink();return this.primaryLink.updateHyperlink(),this},getLink:function(){return this.link},getNode:function(){return this.node},getSibling:function(a){if(a instanceof networkMap.MemberLink){var b=this.getLink().getSibling(this);if(this.memberLinks.length!==b.memberLinks.length)return void 0;var c=this.memberLinks.indexOf(a);return b.memberLinks[c]}return a instanceof networkMap.PrimaryLink?this.getLink().getSibling(this).primaryLink:undefind},getUtilization:function(){var a=null,b=function(b){null!==b&&b>=a&&(a=b)};if(a=this.primaryLink.getUtilization(),void 0===a||null===a)for(var c=0,d=this.memberLinks.length;d>c;c++)b(this.memberLinks[c].getUtilization());return b=null,a}}),networkMap.Link=function(a){this.subLinks={nodeA:null,nodeB:null},this.pathPoints=[],this.updateQ={},this._mode="normal",this.utilizationLabelConfiguration={enabled:!1,fontSize:8,padding:2},this.graph=a.graph,delete a.graph,this.properties=new networkMap.Properties(a,networkMap.Link.defaults),this.properties.addEvent("change",function(a){this.options=this.properties.configuration(),this.draw()}.bind(this)),this.options=this.properties.configuration(),this.configurationWidget=new networkMap.Link.Module.Settings(this.properties),this.colormap=networkMap.colormap[this.properties.get("colormap")],this.datasource=networkMap.datasource[this.properties.get("datasource")],this.setGraph(this.graph)},networkMap.extend(networkMap.Link,networkMap.Options),networkMap.extend(networkMap.Link,networkMap.Observable),networkMap.extend(networkMap.Link,{setProperty:function(a,b){if(!this.editTemplate[a])throw"Unknow id: "+a;this.options[a]=b,this._localConfig[a]=b,this.redraw()},getProperty:function(a){if(!this.editTemplate[a])throw"Unknow id: "+a;return this.properties.get(a)},updateHyperlinks:function(){return this.subLinks.nodeA.updateHyperlinks(),this.subLinks.nodeB.updateHyperlinks(),this},connectedTo:function(a,b){return b?!(this.subLinks.nodeA.node!=a&&this.subLinks.nodeB.node!=a||this.subLinks.nodeA.node!=b&&this.subLinks.nodeB.node!=b):this.subLinks.nodeA.node==a||this.subLinks.nodeB.node==a},mode:function(a){if(!a)return this._mode;if("edit"!==a&&"normal"!==a)throw"Unknown mode: "+a;return this._mode=a,this},getConfiguration:function(){var a=this.properties.extract();return a.nodeA=this.subLinks.nodeA.getConfiguration(),a.nodeB=this.subLinks.nodeB.getConfiguration(),a},getSibling:function(a){return this.subLinks.nodeA===a?this.subLinks.nodeB:this.subLinks.nodeA},setGraph:function(a){null===a&&(this.graph=null,this.draw()),a&&(this.graph=a,this.properties.setDefaults(this.graph.getDefaults("link")),this.datasource=this.properties.get("datasource"),this.colormap=networkMap.colormap[this.properties.get("colormap")],this.options=this.properties.configuration(),this.graph.addEvent("redraw",function(a){this.draw()}.bind(this)),this._setupSVG(this.properties.configuration()),this.draw())},_setupSVG:function(a){var b,c=this.svg=this.graph.getPaintArea().group().back();if(this.shadowPath=this.createShadowPath(c),!a.nodeA||!a.nodeB)throw"Link(create, missing node in link definition)";if(this.nodeA=this.graph.getNode(a.nodeA.id),!this.nodeA)throw"Link(create, nodeA does not exist ("+a.nodeA.id+")";if(b=new networkMap.Link.Module.Edge(this.graph.getPaintArea().group(),this.nodeA.bbox(),SVG.math.Point.create(0,0),SVG.math.Point.create(0,0),a.nodeA.edge).addEvent("updated",this.redrawShadowPath.bind(this)).addEvent("dragstart",function(){this.hidePaths(),this.showShadowPath()}.bind(this)).addEvent("dragend",this.redraw.bind(this)),this.subLinks.nodeA=new networkMap.SubLink(this,this.nodeA,b,c).load(a.nodeA).addEvent("redraw",this.redraw.bind(this)).addEvent("requestHref",function(a){this.fireEvent("requestHref",[a])}.bind(this)),this.nodeB=this.graph.getNode(a.nodeB.id),!this.nodeB)throw"Link(create, nodeA does not exist ("+a.nodeB.id+")";return b=new networkMap.Link.Module.Edge(this.graph.getPaintArea().group(),this.nodeB.bbox(),SVG.math.Point.create(0,0),SVG.math.Point.create(0,0),a.nodeB.edge).addEvent("updated",this.redrawShadowPath.bind(this)).addEvent("dragstart",function(){this.hidePaths(),this.showShadowPath()}.bind(this)).addEvent("dragend",this.redraw.bind(this)),this.subLinks.nodeB=new networkMap.SubLink(this,this.nodeB,b,c).load(a.nodeB).addEvent("redraw",this.redraw.bind(this)).addEvent("requestHref",function(a){this.fireEvent("requestHref",[a])}.bind(this)),this},createShadowPath:function(a){return a.path().attr({fill:"none",stroke:"#000","stroke-dasharray":"3,5","stroke-width":2})},redraw:function(){return this.redrawShadowPath(),this.subLinks.nodeA.draw(this.pathPoints,this.properties),this.subLinks.nodeB.draw(Array.prototype.slice.call(this.pathPoints).reverse(),this.properties),this},draw:function(){return this.svg&&!this.graph?(this.svg.remove(),!1):this.graph?(this.redrawShadowPath().hideShadowPath(),this.subLinks.nodeA.draw(this.pathPoints,this.properties),this.subLinks.nodeB.draw(Array.prototype.slice.call(this.pathPoints).reverse(),this.properties),this.update(),this.nodeA.addEvent("dragstart",this.onNodeDragStart.bind(this)),this.nodeB.addEvent("dragstart",this.onNodeDragStart.bind(this)),this.nodeA.addEvent("drag",this.onNodeDrag.bind(this)),this.nodeB.addEvent("drag",this.onNodeDrag.bind(this)),this.nodeA.addEvent("dragend",this.onNodeDragEnd.bind(this)),void this.nodeB.addEvent("dragend",this.onNodeDragEnd.bind(this))):!1},onNodeDragStart:function(){this.shadowPath.show(),this.hidePaths()},onNodeDrag:function(){this.subLinks.nodeA.edge.setBbox(this.nodeA.bbox()),this.subLinks.nodeB.edge.setBbox(this.nodeB.bbox()),this.redrawShadowPath()},onNodeDragEnd:function(){this.redrawShadowPath().hideShadowPath(),this.subLinks.nodeA.draw(this.pathPoints,this.properties),this.subLinks.nodeB.draw(Array.prototype.slice.call(this.pathPoints).reverse(),this.properties),this.showPaths()},edgePoints:function(){var a=networkMap.vec2,b=this.subLinks.nodeA.node.bbox(),c=this.subLinks.nodeB.node.bbox(),d=a.create(b.width/2,b.height/2),e=a.create(c.width/2,c.height/2),f=parseInt(this.properties.get("inset"))||1,g=(parseInt(this.properties.get("connectionDistance"))||1,parseInt(this.properties.get("staticConnectionDistance"))||1,a.create(b.cx,b.cy)),h=a.create(c.cx,c.cy),i=h.clone().sub(g),j=i.clone().maxDir(),k=j.clone().mul(d);k.sub(j.clone().scale(f));var l=k.clone();k.add(g);var m=i.clone().scale(-1),n=m.clone().maxDir(),o=n.clone().mul(e);o.sub(n.clone().scale(f));var p=o.clone();return o.add(h),this.$edgePoints=this.$edgePoints||{},this.$edgePoints={nodeA:{point:new SVG.math.Point(k.x,k.y),pointer:l,direction:j},nodeB:{point:new SVG.math.Point(o.x,o.y),pointer:p,direction:n}},this.$edgePoints},redrawShadowPath:function(){var a,b=[],c=parseInt(this.properties.get("connectionDistance"))||1,d=parseInt(this.properties.get("staticConnectionDistance"))||1,e=this.edgePoints();return this.pathPoints.length=0,this.subLinks.nodeA.edge.setDefaults(e.nodeA.point,e.nodeA.direction),this.subLinks.nodeB.edge.setDefaults(e.nodeB.point,e.nodeB.direction),a=this.subLinks.nodeA.edge.getEdge(),b.push(a.point.clone()),b.push(a.point.clone().add(a.direction.clone().scale(c))),b.push(a.point.clone().add(a.direction.clone().scale(c+d))),a=this.subLinks.nodeB.edge.getEdge(),b.push(a.point.clone().add(a.direction.clone().scale(c+d))),b.push(a.point.clone().add(a.direction.clone().scale(c))),b.push(a.point.clone()),this.pathPoints=b,this.shadowPath.clear().M(b[0]).L(b[2]).L(b[3]).L(b[5]),this},removeMainPath:function(){this.mainPathA&&this.mainPathA.remove(),this.mainPathB&&this.mainPathB.remove()},hidePaths:function(){return this.subLinks.nodeA.hide(),this.subLinks.nodeB.hide(),this},showPaths:function(){return this.subLinks.nodeA.show(),this.subLinks.nodeB.show(),this},showShadowPath:function(){return this.shadowPath.show(),this},hideShadowPath:function(){return this.shadowPath.hide(),this},drawEdgeHandles:function(){return this.subLinks.nodeA.edge.show(this.nodeA.bbox()),this.subLinks.nodeB.edge.show(this.nodeB.bbox()),this},hideEdgeHandles:function(){return this.subLinks.nodeA.edge.hide(),this.subLinks.nodeB.edge.hide(),this},setUtilizationLabel:function(){return this.subLinks.nodeA.setUtilizationLabel(),this.subLinks.nodeB.setUtilizationLabel(),this},setUtilizationLabelOptions:function(a){return this.subLinks.nodeA.setUtilizationLabelOptions(a),this.subLinks.nodeB.setUtilizationLabelOptions(a),this},showUtilizationLabels:function(){return this.subLinks.nodeA.showUtilizationLabel(),this.subLinks.nodeB.showUtilizationLabel(),this},hideUtilizationLabels:function(){return this.subLinks.nodeA.hideUtilizationLabel(),this.subLinks.nodeB.hideUtilizationLabel(),this},updateUtilizationLabels:function(){return this.setUtilizationLabelPositions(),this},setUtilizationLabelPositions:function(){return this.subLinks.nodeA.setUtilizationLabelPosition(),this.subLinks.nodeB.setUtilizationLabelPosition(),this},registerUpdateEvent:function(a,b,c,d){this.updateQ[a]=this.updateQ[a]||{},this.updateQ[a][b]=this.updateQ[a][b]||[],this.updateQ[a][b].push({link:c,callback:d}),this.graph.registerUpdateEvent(a,b,c,d)},update:function(a){return this.properties.get("globalRefresh")&&a!==!0?this:(this.graph.properties.get("batchUpdate")&&a!==!0||networkMap.each(this.updateQ,function(a,b){if(!networkMap.datasource[b])throw"Unknown datasource ("+b+")";networkMap.each(a,function(a,c){this.properties.get("batchUpdate")?networkMap.datasource[b](c,a):a.forEach(function(a){networkMap.datasource[b](c,a)})}.bind(this))}.bind(this)),this)}}),networkMap.Link.defaultTemplate={width:{label:"Width",type:"number",min:0},inset:{label:"Inset",type:"number",min:1},connectionDistance:{label:"Chamfer",type:"number",min:0},staticConnectionDistance:{label:"Offset",type:"number",min:1},arrowHeadLength:{label:"Arrow Head",type:"number",min:0}},networkMap.Link.registerLinkGenerator=function(a){networkMap.Link._linkGenerator=networkMap.Link.createLinkGenerator(a)},networkMap.Link.createLinkGenerator=function(a){return function(b){var c=b.properties.get("href");return c?void(networkMap.isFunction(c)?b.setLink(c()):b.setLink(c)):void b.setLink(a(b))}},networkMap.Link.registerLinkGenerator(function(a){return null}),networkMap.Link.defaults=new networkMap.Properties({inset:10,connectionDistance:10,staticConnectionDistance:30,arrowHeadLength:10,width:10,background:"#777",globalRefresh:!0,refreshInterval:3e5,datasource:"simulate",batchUpdate:!0,colormap:"flat5"}),networkMap.Link.Module=networkMap.Link.Module||{},networkMap.Link.Module.Settings=function(a,b){this.options={onlyGlobals:!1,header:"Globals",container:null},this.setOptions(b),this.properties=a},networkMap.extend(networkMap.Link.Module.Settings,networkMap.Options),networkMap.extend(networkMap.Link.Module.Settings,{parameters:{width:{label:"Width",type:"number",min:0,global:!0},inset:{label:"Inset",type:"number",min:1,global:!0},connectionDistance:{label:"Chamfer",type:"number",min:0,global:!0},staticConnectionDistance:{label:"Offset",type:"number",min:1,global:!0},arrowHeadLength:{label:"Arrow Head",type:"number",min:0,global:!0}},toElement:function(a,b){b=b||this.properties;var c,d=this.options.container||new networkMap.widget.Accordion,e=function(a,b){return function(c,d){b.set(a,d.value())}};if(c=d.add(this.options.header),networkMap.each(this.parameters,function(a,d){c.appendChild(new networkMap.widget.IntegerInput(a.label,b.get(d,!0),a).addEvent("change",e(d,b)))}.bind(this)),this.options.onlyGlobals)return d;var f={id:{label:"Node",type:"text",disabled:!0,global:!1},name:{label:"Interface",type:"text",disabled:!0,global:!1}},g=function(g,h){c=d.add(g),networkMap.each(f,function(d,f){["id"].some(function(a){return a==f})?c.appendChild(new networkMap.widget.TextInput(d.label,b.get(h+"."+f),d).addEvent("change",e(f,a.properties))):"number"===d.type?c.appendChild(new networkMap.widget.IntegerInput(d.label,a.subLinks[h].primaryLink.properties.get(f,!0),d).addEvent("change",e(f,a.subLinks[h].primaryLink.properties))):"text"===d.type?c.appendChild(new networkMap.widget.TextInput(d.label,a.subLinks[h].primaryLink.properties.get(f),d).addEvent("change",e(f,a.subLinks[h].primaryLink.properties))):"color"===d.type&&c.appendChild(new networkMap.widget.ColorInput(d.label,a.subLinks[h].primaryLink.properties.get(f),d).addEvent("change",e(f,a.subLinks[h].primaryLink.properties)))}.bind(this))}.bind(this);g("Node A","nodeA"),g("Node B","nodeB");var h;return a.subLinks.nodeA&&a.subLinks.nodeB&&a.subLinks.nodeA.memberLinks.length===a.subLinks.nodeB.memberLinks.length?(c=d.add("Sublinks"),h=new networkMap.widget.List,a.subLinks.nodeA.memberLinks.forEach(function(b,c){h.add(b.properties.get("name")+" - "+a.subLinks.nodeB.memberLinks[c].properties.get("name"),{enableDelete:!1})}),c.appendChild(h)):((a.subLinks.nodeA||a.subLinks.nodeB)&&(c=d.add("Sublinks"),h=new networkMap.widget.List),a.subLinks.nodeA&&a.subLinks.nodeA.memberLinks.forEach(function(a,b){h.add(a.properties.get("name")+" - N/A",{enableDelete:!1})}),a.subLinks.nodeB&&a.subLinks.nodeB.memberLinks.forEach(function(a,b){h.add("N/A - "+a.properties.get("name"),{enableDelete:!1})}),(a.subLinks.nodeA||a.subLinks.nodeB)&&c.appendChild(h)),d}}),networkMap.Link.Module=networkMap.Link.Module||{},networkMap.Link.Module.Edge=function(a,b,c,d,e){function f(a){return SVG.math.Point.create(a.x,a.y)}this.svg=a,this.bbox=b,this.defaults={},this.setDefaults(c,d),e&&this.setUserDefined(f(e.point),f(e.pointer),f(e.direction)),this.size=15,this.angleSnap=Math.PI/14,this.pointSnap=5,this.state=this.states.hidden},networkMap.extend(networkMap.Link.Module.Edge,networkMap.Options),networkMap.extend(networkMap.Link.Module.Edge,networkMap.Observable),networkMap.extend(networkMap.Link.Module.Edge,{setDefaults:function(a,b){return this.defaults.point=a,this.defaults.direction=b,this},getDefaults:function(){return this.defaults},setUserDefined:function(a,b,c){return this.userDefined={point:a,pointer:b,direction:c},this},getUserDefined:function(){return this.userDefined},getEdge:function(){return this.userDefined?this.userDefined:this.defaults},setBbox:function(a){return this.bbox=a,this.redraw()},getBbox:function(){return this.bbox},show:function(a){return this.state.show.call(this,a),this},hide:function(){return this.state.hide.call(this),this},redraw:function(){return this.state.redraw.call(this),this},getConfiguration:function(){return this.getUserDefined()},states:{hidden:{show:function(a){this.setBbox(a);var b=this.svg,c=this.getEdge(),d=c.direction.clone().scale(30);d.add(c.point);var e=(this.line=b.line(c.point.x,c.point.y,d.x,d.y).stroke({fill:"none",color:"#000",width:2}),this.directionHandle=this.svg.circle(this.size).center(d.x,d.y).fill("#fff").stroke({color:"#000"}).draggable(function(a,b){var c=this.getEdge(),d=networkMap.vec2.create(a,b),e=c.point.clone(),f=d.sub(e).normalize().scale(30);return f.roundDir(this.angleSnap).add(e),{x:f.x,y:f.y}}.bind(this))),f=this.size/2,g=this.edgeHandle=this.svg.circle(this.size).fill("#fff").stroke({color:"#000"}).center(c.point.x,c.point.y).draggable(function(a,b){return a=a<this.bbox.x-f?this.bbox.x-f:a-a%this.pointSnap,a=a>this.bbox.x+this.bbox.width-f?this.bbox.x+this.bbox.width-f:a-a%this.pointSnap,b=b<this.bbox.y-f?this.bbox.y-f:b-b%this.pointSnap,b=b>this.bbox.y+this.bbox.height-f?this.bbox.y+this.bbox.height-f:b-b%this.pointSnap,{x:a,y:b}}.bind(this));return b.on("dblclick",this.onDoubleClick.bind(this)),e.on("dragstart",this.onDragStart.bind(this)),e.on("dragmove",this.onDirectionHandleMove.bind(this)),e.on("dragend",this.onDragEnd.bind(this)),g.on("dragstart",this.onDragStart.bind(this)),g.on("dragmove",this.onEdgeHandleMove.bind(this)),g.on("dragend",this.onDragEnd.bind(this)),b.front(),this.state=this.states.rendered,this},redraw:function(){var a=this.getEdge();return a.pointer&&(a.point=SVG.math.Point.create(this.bbox.cx,this.bbox.cy).add(a.pointer)),this},hide:function(){return this}},rendered:{show:function(a){return this.bbox=a,this.redraw()},redraw:function(){var a=this.getEdge();a.pointer&&(a.point=SVG.math.Point.create(this.bbox.cx,this.bbox.cy).add(a.pointer));var b=a.direction.clone().scale(30).add(a.point);return this.line.plot(a.point.x,a.point.y,b.x,b.y),this.directionHandle.center(b.x,b.y),this.edgeHandle.center(a.point.x,a.point.y),this},hide:function(){this.directionHandle.dragmove=null,this.edgeHandle.dragmove=null,this.line.remove(),this.directionHandle.remove(),this.edgeHandle.remove(),this.line=null,this.directionHandle=null,this.edgeHandle=null,this.state=this.states.hidden}}},onDoubleClick:function(){this.reset(),this.fireEvent("dragend")},onDragStart:function(){this.fireEvent("dragstart")},onDragEnd:function(){this.fireEvent("dragend")},onDirectionHandleMove:function(a){var b=this.getEdge();this.setUserDefined(b.point,b.point.clone().sub(SVG.math.Point.create(this.bbox.cx,this.bbox.cy)),SVG.math.Point.create(a.target.cx.baseVal.value,a.target.cy.baseVal.value).sub(b.point).normalize()),this.redraw(),this.fireEvent("updated")},onEdgeHandleMove:function(a){var b=this.getEdge(),c=SVG.math.Point.create(a.target.cx.baseVal.value,a.target.cy.baseVal.value);this.setUserDefined(c,c.clone().sub(SVG.math.Point.create(this.bbox.cx,this.bbox.cy)),b.direction),this.fireEvent("updated"),this.redraw()},reset:function(){return this.userDefined=void 0,this.redraw(),this}}),networkMap.drawingCallbacks=networkMap.drawingCallbacks||{},networkMap.registerDrawingCallback=function(a,b){networkMap.drawingCallbacks[a]=b};